var $protobuf=window.protobuf;$protobuf.roots.default=window;var $Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={});$root.cmd=function(){var e,t,n,r,o={};function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function d(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function l(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function c(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function u(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function a(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function p(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function s(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function f(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function y(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function h(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function m(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function $(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function w(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function v(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function g(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function R(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function k(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function b(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function O(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function P(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function C(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function j(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function x(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function D(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function S(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function T(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function A(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function W(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function I(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function U(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function E(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function V(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function L(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function B(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function M(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function F(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function H(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function J(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function K(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function G(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function q(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function z(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function N(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function Q(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function X(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function Y(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function Z(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function _(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}function ee(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return o.CodeCmd=(i.prototype.apply=null,i.prototype.reply=null,i.create=function(e){return new i(e)},i.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.CodeCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.CodeCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},i.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},i.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.CodeCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.CodeCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.CodeCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},i.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},i.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.CodeCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.CodeCmd.Reply.verify(e.reply)))return"reply."+t;return null},i.Apply=(d.prototype.phone="",d.create=function(e){return new d(e)},d.encode=function(e,t){return t=t||$Writer.create(),null!=e.phone&&e.hasOwnProperty("phone")&&t.uint32(10).string(e.phone),t},d.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},d.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.CodeCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.phone=e.string():e.skipType(7&o)}return r},d.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},d.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.phone&&e.hasOwnProperty("phone")&&!$util.isString(e.phone)?"phone: string expected":null},d),i.Reply=(l.prototype.err="",l.create=function(e){return new l(e)},l.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),t},l.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},l.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.CodeCmd.Reply;e.pos<n;){var o=e.uint32();o>>>3==1?r.err=e.string():e.skipType(7&o)}return r},l.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},l.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null},l),i),o.GenderType=(e={},(t=Object.create(e))[e[0]="Male"]=0,t[e[1]="Female"]=1,t),o.MusicInstrStyle=(n={},(r=Object.create(n))[n[0]="Drum"]=0,r[n[1]="Piano"]=1,r),o.SignupCmd=(c.prototype.apply=null,c.prototype.reply=null,c.create=function(e){return new c(e)},c.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.SignupCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.SignupCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},c.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},c.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SignupCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.SignupCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.SignupCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},c.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},c.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.SignupCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.SignupCmd.Reply.verify(e.reply)))return"reply."+t;return null},c.Apply=(u.prototype.code="",u.prototype.phone="",u.prototype.passwd="",u.prototype.name="",u.prototype.school="",u.prototype.birthday=$util.Long?$util.Long.fromBits(0,0,!1):0,u.prototype.style=0,u.prototype.gender=0,u.prototype.photo=$util.newBuffer([]),u.create=function(e){return new u(e)},u.encode=function(e,t){return t=t||$Writer.create(),null!=e.code&&e.hasOwnProperty("code")&&t.uint32(10).string(e.code),null!=e.phone&&e.hasOwnProperty("phone")&&t.uint32(18).string(e.phone),null!=e.passwd&&e.hasOwnProperty("passwd")&&t.uint32(26).string(e.passwd),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(34).string(e.name),null!=e.school&&e.hasOwnProperty("school")&&t.uint32(42).string(e.school),null!=e.birthday&&e.hasOwnProperty("birthday")&&t.uint32(48).int64(e.birthday),null!=e.style&&e.hasOwnProperty("style")&&t.uint32(56).uint32(e.style),null!=e.gender&&e.hasOwnProperty("gender")&&t.uint32(64).uint32(e.gender),null!=e.photo&&e.hasOwnProperty("photo")&&t.uint32(74).bytes(e.photo),t},u.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},u.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SignupCmd.Apply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.code=e.string();break;case 2:r.phone=e.string();break;case 3:r.passwd=e.string();break;case 4:r.name=e.string();break;case 5:r.school=e.string();break;case 6:r.birthday=e.int64();break;case 7:r.style=e.uint32();break;case 8:r.gender=e.uint32();break;case 9:r.photo=e.bytes();break;default:e.skipType(7&o)}}return r},u.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},u.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.code&&e.hasOwnProperty("code")&&!$util.isString(e.code)?"code: string expected":null!=e.phone&&e.hasOwnProperty("phone")&&!$util.isString(e.phone)?"phone: string expected":null!=e.passwd&&e.hasOwnProperty("passwd")&&!$util.isString(e.passwd)?"passwd: string expected":null!=e.name&&e.hasOwnProperty("name")&&!$util.isString(e.name)?"name: string expected":null!=e.school&&e.hasOwnProperty("school")&&!$util.isString(e.school)?"school: string expected":null!=e.birthday&&e.hasOwnProperty("birthday")&&!($util.isInteger(e.birthday)||e.birthday&&$util.isInteger(e.birthday.low)&&$util.isInteger(e.birthday.high))?"birthday: integer|Long expected":null!=e.style&&e.hasOwnProperty("style")&&!$util.isInteger(e.style)?"style: integer expected":null!=e.gender&&e.hasOwnProperty("gender")&&!$util.isInteger(e.gender)?"gender: integer expected":null!=e.photo&&e.hasOwnProperty("photo")&&!(e.photo&&"number"==typeof e.photo.length||$util.isString(e.photo))?"photo: buffer expected":null},u),c.Reply=(a.prototype.err="",a.create=function(e){return new a(e)},a.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),t},a.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},a.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SignupCmd.Reply;e.pos<n;){var o=e.uint32();o>>>3==1?r.err=e.string():e.skipType(7&o)}return r},a.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},a.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null},a),c),o.SigninCmd=(p.prototype.apply=null,p.prototype.reply=null,p.create=function(e){return new p(e)},p.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.SigninCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.SigninCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},p.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},p.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SigninCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.SigninCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.SigninCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},p.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},p.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.SigninCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.SigninCmd.Reply.verify(e.reply)))return"reply."+t;return null},p.Apply=(s.prototype.phone="",s.prototype.passwd="",s.create=function(e){return new s(e)},s.encode=function(e,t){return t=t||$Writer.create(),null!=e.phone&&e.hasOwnProperty("phone")&&t.uint32(10).string(e.phone),null!=e.passwd&&e.hasOwnProperty("passwd")&&t.uint32(18).string(e.passwd),t},s.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},s.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SigninCmd.Apply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.phone=e.string();break;case 2:r.passwd=e.string();break;default:e.skipType(7&o)}}return r},s.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},s.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.phone&&e.hasOwnProperty("phone")&&!$util.isString(e.phone)?"phone: string expected":null!=e.passwd&&e.hasOwnProperty("passwd")&&!$util.isString(e.passwd)?"passwd: string expected":null},s),p.Reply=(f.prototype.err="",f.prototype.role=0,f.prototype.addr="",f.prototype.token="",f.create=function(e){return new f(e)},f.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.role&&e.hasOwnProperty("role")&&t.uint32(16).uint32(e.role),null!=e.addr&&e.hasOwnProperty("addr")&&t.uint32(26).string(e.addr),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(34).string(e.token),t},f.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},f.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SigninCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.role=e.uint32();break;case 3:r.addr=e.string();break;case 4:r.token=e.string();break;default:e.skipType(7&o)}}return r},f.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},f.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null!=e.role&&e.hasOwnProperty("role")&&!$util.isInteger(e.role)?"role: integer expected":null!=e.addr&&e.hasOwnProperty("addr")&&!$util.isString(e.addr)?"addr: string expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},f),p),o.ParentCmd=(y.prototype.apply=null,y.prototype.reply=null,y.create=function(e){return new y(e)},y.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.ParentCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.ParentCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},y.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},y.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ParentCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.ParentCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.ParentCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},y.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},y.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.ParentCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.ParentCmd.Reply.verify(e.reply)))return"reply."+t;return null},y.Apply=(h.prototype.code="",h.create=function(e){return new h(e)},h.encode=function(e,t){return t=t||$Writer.create(),null!=e.code&&e.hasOwnProperty("code")&&t.uint32(10).string(e.code),t},h.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},h.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ParentCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.code=e.string():e.skipType(7&o)}return r},h.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},h.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.code&&e.hasOwnProperty("code")&&!$util.isString(e.code)?"code: string expected":null},h),y.Reply=(m.prototype.err="",m.prototype.url="",m.prototype.addr="",m.prototype.token="",m.create=function(e){return new m(e)},m.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.url&&e.hasOwnProperty("url")&&t.uint32(18).string(e.url),null!=e.addr&&e.hasOwnProperty("addr")&&t.uint32(26).string(e.addr),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(34).string(e.token),t},m.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},m.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ParentCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.url=e.string();break;case 3:r.addr=e.string();break;case 4:r.token=e.string();break;default:e.skipType(7&o)}}return r},m.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},m.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null!=e.url&&e.hasOwnProperty("url")&&!$util.isString(e.url)?"url: string expected":null!=e.addr&&e.hasOwnProperty("addr")&&!$util.isString(e.addr)?"addr: string expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},m),y),o.KeepaliveCmd=($.create=function(e){return new $(e)},$.encode=function(e,t){return t=t||$Writer.create()},$.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},$.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.KeepaliveCmd;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},$.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},$.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},$),o.UserInfo=(w.prototype.id=0,w.prototype.teacher=null,w.prototype.student=null,w.prototype.adminer=null,w.create=function(e){return new w(e)},w.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.teacher&&e.hasOwnProperty("teacher")&&$root.cmd.UserInfo.Teacher.encode(e.teacher,t.uint32(18).fork()).ldelim(),null!=e.student&&e.hasOwnProperty("student")&&$root.cmd.UserInfo.Student.encode(e.student,t.uint32(26).fork()).ldelim(),null!=e.adminer&&e.hasOwnProperty("adminer")&&$root.cmd.UserInfo.Adminer.encode(e.adminer,t.uint32(34).fork()).ldelim(),t},w.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},w.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.UserInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.id=e.uint32();break;case 2:r.teacher=$root.cmd.UserInfo.Teacher.decode(e,e.uint32());break;case 3:r.student=$root.cmd.UserInfo.Student.decode(e,e.uint32());break;case 4:r.adminer=$root.cmd.UserInfo.Adminer.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},w.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},w.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id))return"id: integer expected";var t;if(null!=e.teacher&&e.hasOwnProperty("teacher")&&(t=$root.cmd.UserInfo.Teacher.verify(e.teacher)))return"teacher."+t;if(null!=e.student&&e.hasOwnProperty("student")&&(t=$root.cmd.UserInfo.Student.verify(e.student)))return"student."+t;if(null!=e.adminer&&e.hasOwnProperty("adminer")&&(t=$root.cmd.UserInfo.Adminer.verify(e.adminer)))return"adminer."+t;return null},w.Teacher=(v.create=function(e){return new v(e)},v.encode=function(e,t){return t=t||$Writer.create()},v.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},v.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.UserInfo.Teacher;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},v.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},v.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},v),w.Student=(g.create=function(e){return new g(e)},g.encode=function(e,t){return t=t||$Writer.create()},g.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},g.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.UserInfo.Student;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},g.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},g.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},g),w.Adminer=(R.create=function(e){return new R(e)},R.encode=function(e,t){return t=t||$Writer.create()},R.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},R.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.UserInfo.Adminer;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},R.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},R.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},R),w),o.VerifyCmd=(k.prototype.apply=null,k.prototype.reply=null,k.create=function(e){return new k(e)},k.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.VerifyCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.VerifyCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},k.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},k.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.VerifyCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.VerifyCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.VerifyCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},k.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},k.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.VerifyCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.VerifyCmd.Reply.verify(e.reply)))return"reply."+t;return null},k.Apply=(b.prototype.token="",b.create=function(e){return new b(e)},b.encode=function(e,t){return t=t||$Writer.create(),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(10).string(e.token),t},b.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},b.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.VerifyCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.token=e.string():e.skipType(7&o)}return r},b.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},b.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},b),k.Reply=(O.prototype.err="",O.prototype.token="",O.prototype.info=null,O.create=function(e){return new O(e)},O.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(18).string(e.token),null!=e.info&&e.hasOwnProperty("info")&&$root.cmd.UserInfo.encode(e.info,t.uint32(26).fork()).ldelim(),t},O.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},O.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.VerifyCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.token=e.string();break;case 3:r.info=$root.cmd.UserInfo.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},O.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},O.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err))return"err: string expected";if(null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token))return"token: string expected";if(null!=e.info&&e.hasOwnProperty("info")){var t=$root.cmd.UserInfo.verify(e.info);if(t)return"info."+t}return null},O),k),o.ReconnectCmd=(P.prototype.apply=null,P.prototype.reply=null,P.create=function(e){return new P(e)},P.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.ReconnectCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.ReconnectCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},P.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},P.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReconnectCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.ReconnectCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.ReconnectCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},P.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},P.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.ReconnectCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.ReconnectCmd.Reply.verify(e.reply)))return"reply."+t;return null},P.Apply=(C.prototype.id=0,C.prototype.token="",C.create=function(e){return new C(e)},C.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(18).string(e.token),t},C.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},C.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReconnectCmd.Apply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.id=e.uint32();break;case 2:r.token=e.string();break;default:e.skipType(7&o)}}return r},C.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},C.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},C),P.Reply=(j.prototype.err="",j.prototype.token="",j.create=function(e){return new j(e)},j.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(18).string(e.token),t},j.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},j.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReconnectCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.token=e.string();break;default:e.skipType(7&o)}}return r},j.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},j.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},j),P),o.AttachCmd=(x.prototype.apply=null,x.prototype.reply=null,x.create=function(e){return new x(e)},x.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.AttachCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.AttachCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},x.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},x.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.AttachCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.AttachCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.AttachCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},x.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},x.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.AttachCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.AttachCmd.Reply.verify(e.reply)))return"reply."+t;return null},x.Apply=(D.prototype.token="",D.create=function(e){return new D(e)},D.encode=function(e,t){return t=t||$Writer.create(),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(10).string(e.token),t},D.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},D.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.AttachCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.token=e.string():e.skipType(7&o)}return r},D.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},D.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},D),x.Reply=(S.prototype.err="",S.prototype.token="",S.prototype.user=null,S.create=function(e){return new S(e)},S.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(18).string(e.token),null!=e.user&&e.hasOwnProperty("user")&&$root.cmd.UserInfo.encode(e.user,t.uint32(26).fork()).ldelim(),t},S.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},S.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.AttachCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.token=e.string();break;case 3:r.user=$root.cmd.UserInfo.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},S.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},S.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err))return"err: string expected";if(null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token))return"token: string expected";if(null!=e.user&&e.hasOwnProperty("user")){var t=$root.cmd.UserInfo.verify(e.user);if(t)return"user."+t}return null},S),x),o.ReserveCmd=(T.prototype.apply=null,T.prototype.reply=null,T.create=function(e){return new T(e)},T.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.ReserveCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.ReserveCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},T.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},T.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReserveCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.ReserveCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.ReserveCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},T.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},T.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.ReserveCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.ReserveCmd.Reply.verify(e.reply)))return"reply."+t;return null},T.Apply=(A.prototype.id=0,A.create=function(e){return new A(e)},A.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),t},A.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},A.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReserveCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.id=e.uint32():e.skipType(7&o)}return r},A.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},A.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null},A),T.Reply=(W.prototype.err="",W.create=function(e){return new W(e)},W.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),t},W.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},W.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReserveCmd.Reply;e.pos<n;){var o=e.uint32();o>>>3==1?r.err=e.string():e.skipType(7&o)}return r},W.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},W.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null},W),T),o.SwitchCmd=(I.prototype.addr="",I.prototype.token="",I.create=function(e){return new I(e)},I.encode=function(e,t){return t=t||$Writer.create(),null!=e.addr&&e.hasOwnProperty("addr")&&t.uint32(10).string(e.addr),null!=e.token&&e.hasOwnProperty("token")&&t.uint32(18).string(e.token),t},I.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},I.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.SwitchCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.addr=e.string();break;case 2:r.token=e.string();break;default:e.skipType(7&o)}}return r},I.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},I.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.addr&&e.hasOwnProperty("addr")&&!$util.isString(e.addr)?"addr: string expected":null!=e.token&&e.hasOwnProperty("token")&&!$util.isString(e.token)?"token: string expected":null},I),o.ShowTipsCmd=(U.prototype.err="",U.create=function(e){return new U(e)},U.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),t},U.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},U.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ShowTipsCmd;e.pos<n;){var o=e.uint32();o>>>3==1?r.err=e.string():e.skipType(7&o)}return r},U.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},U.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null},U),o.StartClassCmd=(E.prototype.apply=null,E.prototype.reply=null,E.create=function(e){return new E(e)},E.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.StartClassCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.StartClassCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},E.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},E.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.StartClassCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.StartClassCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.StartClassCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},E.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},E.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.StartClassCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.StartClassCmd.Reply.verify(e.reply)))return"reply."+t;return null},E.Apply=(V.prototype.cid=0,V.create=function(e){return new V(e)},V.encode=function(e,t){return t=t||$Writer.create(),null!=e.cid&&e.hasOwnProperty("cid")&&t.uint32(8).uint32(e.cid),t},V.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},V.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.StartClassCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.cid=e.uint32():e.skipType(7&o)}return r},V.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},V.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.cid&&e.hasOwnProperty("cid")&&!$util.isInteger(e.cid)?"cid: integer expected":null},V),E.Reply=(L.prototype.err="",L.create=function(e){return new L(e)},L.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),t},L.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},L.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.StartClassCmd.Reply;e.pos<n;){var o=e.uint32();o>>>3==1?r.err=e.string():e.skipType(7&o)}return r},L.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},L.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null},L),E),o.CloseClassCmd=(B.create=function(e){return new B(e)},B.encode=function(e,t){return t=t||$Writer.create()},B.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},B.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.CloseClassCmd;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},B.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},B.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},B),o.EnterHallCmd=(M.create=function(e){return new M(e)},M.encode=function(e,t){return t=t||$Writer.create()},M.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},M.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.EnterHallCmd;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},M.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},M.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},M),o.EnterRoomCmd=(F.prototype.apply=null,F.prototype.reply=null,F.create=function(e){return new F(e)},F.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.EnterRoomCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.EnterRoomCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},F.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},F.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.EnterRoomCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.EnterRoomCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.EnterRoomCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},F.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},F.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.EnterRoomCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.EnterRoomCmd.Reply.verify(e.reply)))return"reply."+t;return null},F.Apply=(H.prototype.id=0,H.create=function(e){return new H(e)},H.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),t},H.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},H.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.EnterRoomCmd.Apply;e.pos<n;){var o=e.uint32();o>>>3==1?r.id=e.uint32():e.skipType(7&o)}return r},H.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},H.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null},H),F.Reply=(J.prototype.err="",J.prototype.id=0,J.create=function(e){return new J(e)},J.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(16).uint32(e.id),t},J.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},J.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.EnterRoomCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.id=e.uint32();break;default:e.skipType(7&o)}}return r},J.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},J.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null},J),F),o.JoinedClassCmd=(K.prototype.id=0,K.create=function(e){return new K(e)},K.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),t},K.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},K.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.JoinedClassCmd;e.pos<n;){var o=e.uint32();o>>>3==1?r.id=e.uint32():e.skipType(7&o)}return r},K.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},K.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null},K),o.ReadyClassCmd=(G.prototype.apply=null,G.prototype.reply=null,G.create=function(e){return new G(e)},G.encode=function(e,t){return t=t||$Writer.create(),null!=e.apply&&e.hasOwnProperty("apply")&&$root.cmd.ReadyClassCmd.Apply.encode(e.apply,t.uint32(10).fork()).ldelim(),null!=e.reply&&e.hasOwnProperty("reply")&&$root.cmd.ReadyClassCmd.Reply.encode(e.reply,t.uint32(18).fork()).ldelim(),t},G.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},G.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReadyClassCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.apply=$root.cmd.ReadyClassCmd.Apply.decode(e,e.uint32());break;case 2:r.reply=$root.cmd.ReadyClassCmd.Reply.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},G.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},G.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t;if(null!=e.apply&&e.hasOwnProperty("apply")&&(t=$root.cmd.ReadyClassCmd.Apply.verify(e.apply)))return"apply."+t;if(null!=e.reply&&e.hasOwnProperty("reply")&&(t=$root.cmd.ReadyClassCmd.Reply.verify(e.reply)))return"reply."+t;return null},G.Apply=(q.create=function(e){return new q(e)},q.encode=function(e,t){return t=t||$Writer.create()},q.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},q.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReadyClassCmd.Apply;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},q.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},q.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},q),G.Reply=(z.prototype.err="",z.prototype.id=0,z.create=function(e){return new z(e)},z.encode=function(e,t){return t=t||$Writer.create(),null!=e.err&&e.hasOwnProperty("err")&&t.uint32(10).string(e.err),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(16).uint32(e.id),t},z.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},z.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ReadyClassCmd.Reply;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.err=e.string();break;case 2:r.id=e.uint32();break;default:e.skipType(7&o)}}return r},z.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},z.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.err&&e.hasOwnProperty("err")&&!$util.isString(e.err)?"err: string expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null},z),G),o.MidiCmd=(N.prototype.data="",N.create=function(e){return new N(e)},N.encode=function(e,t){return t=t||$Writer.create(),null!=e.data&&e.hasOwnProperty("data")&&t.uint32(10).string(e.data),t},N.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},N.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.MidiCmd;e.pos<n;){var o=e.uint32();o>>>3==1?r.data=e.string():e.skipType(7&o)}return r},N.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},N.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.data&&e.hasOwnProperty("data")&&!$util.isString(e.data)?"data: string expected":null},N),o.WebrtcCmd=(Q.prototype.id=0,Q.prototype.type="",Q.prototype.data="",Q.create=function(e){return new Q(e)},Q.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.type&&e.hasOwnProperty("type")&&t.uint32(26).string(e.type),null!=e.data&&e.hasOwnProperty("data")&&t.uint32(34).string(e.data),t},Q.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},Q.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.WebrtcCmd;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.id=e.uint32();break;case 3:r.type=e.string();break;case 4:r.data=e.string();break;default:e.skipType(7&o)}}return r},Q.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},Q.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id)?"id: integer expected":null!=e.type&&e.hasOwnProperty("type")&&!$util.isString(e.type)?"type: string expected":null!=e.data&&e.hasOwnProperty("data")&&!$util.isString(e.data)?"data: string expected":null},Q),o.FileCmd=(X.create=function(e){return new X(e)},X.encode=function(e,t){return t=t||$Writer.create()},X.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},X.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.FileCmd;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},X.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},X.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},X),o.TeacherInfo=(Y.prototype.name="",Y.prototype.birthday=$util.Long?$util.Long.fromBits(0,0,!1):0,Y.prototype.school="",Y.prototype.job=0,Y.prototype.title=0,Y.prototype.no=0,Y.prototype.phone="",Y.prototype.email="",Y.prototype.entryTime=$util.Long?$util.Long.fromBits(0,0,!1):0,Y.create=function(e){return new Y(e)},Y.encode=function(e,t){return t=t||$Writer.create(),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(10).string(e.name),null!=e.birthday&&e.hasOwnProperty("birthday")&&t.uint32(16).int64(e.birthday),null!=e.school&&e.hasOwnProperty("school")&&t.uint32(26).string(e.school),null!=e.job&&e.hasOwnProperty("job")&&t.uint32(32).uint32(e.job),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(40).uint32(e.title),null!=e.no&&e.hasOwnProperty("no")&&t.uint32(48).uint32(e.no),null!=e.phone&&e.hasOwnProperty("phone")&&t.uint32(58).string(e.phone),null!=e.email&&e.hasOwnProperty("email")&&t.uint32(66).string(e.email),null!=e.entryTime&&e.hasOwnProperty("entryTime")&&t.uint32(72).int64(e.entryTime),t},Y.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},Y.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.TeacherInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.name=e.string();break;case 2:r.birthday=e.int64();break;case 3:r.school=e.string();break;case 4:r.job=e.uint32();break;case 5:r.title=e.uint32();break;case 6:r.no=e.uint32();break;case 7:r.phone=e.string();break;case 8:r.email=e.string();break;case 9:r.entryTime=e.int64();break;default:e.skipType(7&o)}}return r},Y.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},Y.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.name&&e.hasOwnProperty("name")&&!$util.isString(e.name)?"name: string expected":null!=e.birthday&&e.hasOwnProperty("birthday")&&!($util.isInteger(e.birthday)||e.birthday&&$util.isInteger(e.birthday.low)&&$util.isInteger(e.birthday.high))?"birthday: integer|Long expected":null!=e.school&&e.hasOwnProperty("school")&&!$util.isString(e.school)?"school: string expected":null!=e.job&&e.hasOwnProperty("job")&&!$util.isInteger(e.job)?"job: integer expected":null!=e.title&&e.hasOwnProperty("title")&&!$util.isInteger(e.title)?"title: integer expected":null!=e.no&&e.hasOwnProperty("no")&&!$util.isInteger(e.no)?"no: integer expected":null!=e.phone&&e.hasOwnProperty("phone")&&!$util.isString(e.phone)?"phone: string expected":null!=e.email&&e.hasOwnProperty("email")&&!$util.isString(e.email)?"email: string expected":null!=e.entryTime&&e.hasOwnProperty("entryTime")&&!($util.isInteger(e.entryTime)||e.entryTime&&$util.isInteger(e.entryTime.low)&&$util.isInteger(e.entryTime.high))?"entryTime: integer|Long expected":null},Y),o.TeacherData=(Z.prototype.id=0,Z.prototype.info=null,Z.create=function(e){return new Z(e)},Z.encode=function(e,t){return t=t||$Writer.create(),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(8).uint32(e.id),null!=e.info&&e.hasOwnProperty("info")&&$root.cmd.TeacherInfo.encode(e.info,t.uint32(18).fork()).ldelim(),t},Z.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},Z.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.TeacherData;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.id=e.uint32();break;case 2:r.info=$root.cmd.TeacherInfo.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},Z.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},Z.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!$util.isInteger(e.id))return"id: integer expected";if(null!=e.info&&e.hasOwnProperty("info")){var t=$root.cmd.TeacherInfo.verify(e.info);if(t)return"info."+t}return null},Z),o.ClassInfo=(_.create=function(e){return new _(e)},_.encode=function(e,t){return t=t||$Writer.create()},_.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},_.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ClassInfo;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},_.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},_.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},_),o.ClassData=(ee.create=function(e){return new ee(e)},ee.encode=function(e,t){return t=t||$Writer.create()},ee.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},ee.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new $root.cmd.ClassData;e.pos<n;){var o=e.uint32();e.skipType(7&o)}return r},ee.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},ee.verify=function(e){return"object"!=typeof e||null===e?"object expected":null},ee),o}();
class Adapter {
    constructor(service, interfacer) {
        this._service = service;
        this._interfacer = interfacer;
    }
    get interfacer() {
        return this._interfacer;
    }
    get id() {
        return this._data.id;
    }
    // 
    close() {
        window.location.href = "about:blank";
        window.close();
    }
    // 
    open(url) {
        window.open(url, "vedios", "width=1280, height=720, top=0, left=0, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");
    }
    initMidi() {
        this._midi = new Midier(this);
        this._midi.init();
    }
    initWebrtc() {
        this._webrt = new Webrtcer(this);
        let self = this;
        this._webrt.init(function () {
            self.onReady();
        });
    }
    onEnterHall() {
    }
    onReady() {
    }
    /*public onEnterClass(data: cmd.EnterClassCmd.Reply) {
    }*/
    onReadyClass(data) {
        //this._webrt.launch(data.id);
    }
    onJoinedClass(data) {
        this._webrt.launch(data.id);
    }
    onMidi(data) {
        alert("midi: " + JSON.stringify(data));
        console.log("midi: " + JSON.stringify(data));
    }
    onWebrtc(id, type, data) {
        this._webrt.onMessage(id, type, JSON.parse(data));
    }
    onEstablish(id) {
    }
    onLoad(data) {
        this._data = data;
        this.onLaunch();
    }
    onLaunch() {
        var self = this;
        function frame() {
            self.onFrame();
            window.requestAnimationFrame(frame);
        }
        frame();
    }
    onFrame() {
    }
    /*public code(phone: string, func?: any) {
        let c = new cmd.CodeCmd();
        c.apply = {phone: phone};
        this._service.post(c, func);
    }*/
    code(data, func) {
        let c = new cmd.CodeCmd();
        c.apply = data;
        this._service.post(c, func);
    }
    /*public signin(phone: string, passwd: string, func?: any) {
        let c = new cmd.SigninCmd();
        c.apply = {phone: phone, passwd: passwd};
        this._service.post(c, func);
    }*/
    signin(data, func) {
        let c = new cmd.SigninCmd();
        c.apply = data;
        this._service.post(c, func);
    }
    /*public signup(phone: string, passwd: string, code: string, name: string, school: string, birthday: number, style: number, gender: number, photo: Uint8Array, func?: any) {
        let c = new cmd.SignupCmd();
        c.apply = {phone: phone, passwd: passwd, code: code, name: name, school: school, birthday: birthday, style: style, gender: gender, photo: photo};
        this._service.post(c, func);
    }*/
    signup(data, func) {
        let c = new cmd.SignupCmd();
        c.apply = data;
        this._service.post(c, func);
    }
    post(cmd, func) {
        this._service.post(cmd, func);
    }
    send(cmd, func) {
        this._service.send(cmd, func);
    }
    sendMidi(data) {
        let c = new cmd.MidiCmd();
        c.data = JSON.stringify(data);
        this.send(c);
    }
    sendWebrtc(id, type, data) {
        let c = new cmd.WebrtcCmd();
        c.id = id;
        c.type = type;
        c.data = JSON.stringify(data);
        console.log("sendWebrtc  id: " + id + "  type: " + type); // + "  data: " + c.data);
        this.send(c);
    }
    startClass() {
        let c = new cmd.StartClassCmd();
        this.send(c);
    }
    enterClass() {
        /*let c = new cmd.EnterClassCmd();
        var str = Dom.queryParam("room");
        c.apply = {id: parseInt(str)};
        this.send(c);*/
    }
    readyClass() {
        let c = new cmd.ReadyClassCmd();
        this.send(c);
    }
}
class AdminerAdapter extends Adapter {
    constructor(service, interfacer) {
        super(service, interfacer);
    }
}
class Interfacer {
    constructor() {
        this.onError = function (err) {
            console.log("onError: ", err);
        };
        this.onAdminer = function (addr, token) {
            console.log("onAdminer");
        };
        this.onStudent = function (addr, token) {
            console.log("onStudent");
        };
        this.onTeacher = function (addr, token) {
            console.log("onTeacher");
        };
        this.onRemoteStream = function (id, stream) {
            console.log("onRemoteStream");
        };
        this.onEnterClass = function (data) {
            console.log("onEnterClass");
        };
        this.onUserInfo = function (data) {
        };
    }
}
class Level {
    constructor() {
        this._arrs = [];
    }
    load(div, data, width, height) {
        this._div = div;
        //this._div.style.width = width + 'px';
        this._width = width;
        this._height = height;
        var ns = core.midiToSequenceProto(data);
        var qpm = ns.tempos[0].qpm;
        var delta = Level._deltaTime;
        var cnt = ns.totalTime / delta;
        var confs = Level._confs;
        for (var i = 0, l = ns.notes.length; i < l; i++) {
            this._arrs.push(new Array());
            this._arrs.length = cnt;
        }
        //this.create(div, cnt);
        for (var i = 0, l = ns.notes.length; i < l; i++) {
            var n = ns.notes[i];
            var c = this.find(n.pitch);
            var b = n.startTime / delta;
            var e = n.endTime / delta;
            for (; b < e; b++) {
                this._arrs[c.idx][b] = c;
            }
        }
    }
    find(pitch) {
        for (let i = 0, l = Level._confs.length; i < l; i++) {
            let c = Level._confs[i];
            if (c.value = pitch) {
                return c;
            }
        }
        return null;
    }
    apply(conf) {
        let div = document.createElement('div');
        let cnt = Level._confs.length;
        let width = Math.floor(this._width / (cnt + (cnt - 1) * Level._wgap));
        let height = Math.floor(this._height / (Level._hcnt + Math.floor((Level._hcnt - 1)) * Level._hgap));
        div.style.cssText = 'width:' + width + 'px;height:' + height + 'px;color:' + conf.color;
        div.style.left = (width * conf.idx + width * conf.idx * Level._wgap) + 'px';
        this._div.appendChild(div);
    }
    onFrame(ts) {
    }
}
Level._hcnt = 6;
Level._hgap = 0.1;
Level._wgap = 0.1;
Level._deltaTime = 0.125 * 2;
Level._confs = [
    { value: 36, idx: 0, color: 'blue' },
    { value: 38, idx: 1, color: 'blue' },
    { value: 48, idx: 2, color: 'blue' },
    { value: 43, idx: 3, color: 'blue' },
    { value: 41, idx: 4, color: 'blue' },
    { value: 46, idx: 5, color: 'blue' },
    { value: 55, idx: 6, color: 'blue' },
    { value: 52, idx: 7, color: 'blue' },
    { value: 51, idx: 8, color: 'blue' },
];
class Private {
    static get service() {
        if (Private._service == null) {
            Private._service = new Service(Private._url, Private._interfacer);
        }
        return Private._service;
    }
    static get teacher() {
        return Private._teacher;
    }
    static get student() {
        return Private._student;
    }
    static get adminer() {
        return Private._adminer;
    }
    static startService() {
        if (Private._adapter == null) {
            Private._adapter = Private.service.createAdapter();
        }
        return Private._adapter;
    }
    static startStudent(addr, token) {
        if (Private._student == null) {
            Private._student = Private.service.createStudent(addr, token);
        }
        return Private._student;
    }
    static startTeacher(addr, token) {
        if (Private._teacher == null) {
            Private._teacher = Private.service.createTeacher(addr, token);
        }
        return Private._teacher;
    }
    static startAdminer(addr, token) {
        if (Private._adminer == null) {
            Private._adminer = Private.service.createAdminer(addr, token);
        }
        return Private._adminer;
    }
}
Private._url = "http://101.201.196.248:20005/cmd";
//private static _url: string = "https://www.lwin24.xyz:20005/cmd";
Private._service = null;
Private._interfacer = new Interfacer();
Private._adapter = null;
Private._teacher = null;
Private._student = null;
Private._adminer = null;
function startService() {
    return Private.startService();
}
function startStudent(addr, token) {
    return Private.startStudent(addr, token);
}
function startTeacher(addr, token) {
    return Private.startTeacher(addr, token);
}
function startAdminer(addr, token) {
    return Private.startAdminer(addr, token);
}
function teacher() {
    return Private.teacher;
}
function student() {
    return Private.student;
}
function adminer() {
    return Private.adminer;
}
class Midier {
    constructor(adapter) {
        this._adapter = adapter;
    }
    init() {
        let navigator = window.navigator;
        if (!navigator.requestMIDIAccess) {
            alert("unsupport midi device");
            return;
        }
        let self = this;
        console.log('Browser supports MIDI!');
        navigator.requestMIDIAccess()
            .then(function (midi) {
            self.onSuccess(midi);
        }, function () {
            self.onFailure();
        });
    }
    onSuccess(midi) {
        console.log('got midi!', midi);
        let inputs = midi.inputs.values();
        let self = this;
        let func = function (message) {
            self.onInput(message);
        };
        for (let input = inputs.next(); input && !input.done; input = inputs.next()) { // each time there is a midi message call the onMIDIMessage function
            input.value.onmidimessage = func;
        }
    }
    onInput(message) {
        console.log(message.data);
        this._adapter.sendMidi(message.data);
    }
    onFailure() {
        console.error('no access to your midi devices.');
    }
}
class Service {
    constructor(url, interfacer) {
        this._handler = new Handler();
        this._networker = null;
        this._cmds = [];
        this.goto = function (url) {
            console.log("goto: ", url);
        };
        //this._adapter = adapter;
        this._interfacer = interfacer;
        this._networker = new Networker(this, this._handler);
        this._networker.url = url;
        for (let k in cmd) {
            this._cmds.push({ name: k, func: cmd[k] });
        }
        this.onRegister();
    }
    createAdapter() {
        var adapter = new Adapter(this, this._interfacer);
        this._adapter = adapter;
        return adapter;
    }
    createStudent(addr, token) {
        this._addr = addr;
        this._token = token;
        var adapter = new StudentAdapter(this, this._interfacer);
        this._adapter = adapter;
        this._networker.connect(this._addr);
        return adapter;
    }
    createTeacher(addr, token) {
        this._addr = addr;
        this._token = token;
        var adapter = new TeacherAdapter(this, this._interfacer);
        this._adapter = adapter;
        this._networker.connect(this._addr);
        return adapter;
    }
    createAdminer(url, token) {
        this._networker.url = url;
        var adapter = new AdminerAdapter(this, this._interfacer);
        this._adapter = adapter;
        var c = new cmd.VerifyCmd();
        c.apply = { token: this._token };
        this.post(c);
        return adapter;
    }
    post(cmd, func) {
        this._networker.post(cmd, func);
    }
    send(cmd, func) {
        this._networker.sendCmd(cmd, func);
    }
    onRegister() {
        this.register(cmd.CodeCmd, this.onCode);
        this.register(cmd.SignupCmd, this.onSignup);
        this.register(cmd.SigninCmd, this.onSignin);
        this.register(cmd.VerifyCmd, this.onVerify);
        this.register(cmd.EnterHallCmd, this.onEnterHall);
        this.register(cmd.StartClassCmd, this.onStartClass);
        //this.register(cmd.EnterClassCmd, this.onEnterClass);
        this.register(cmd.ReadyClassCmd, this.onReadyClass);
        this.register(cmd.JoinedClassCmd, this.onJoinedClass);
        this.register(cmd.MidiCmd, this.onMidi);
        this.register(cmd.WebrtcCmd, this.onWebrtc);
    }
    onError(err) {
        this._adapter.interfacer.onError(err);
    }
    register(cls, func) {
        let name = this.find(new cls().constructor);
        this._handler.register(cls, name, func, this);
    }
    find(f) {
        for (let i = 0, l = this._cmds.length; i < l; i++) {
            if (this._cmds[i].func == f) {
                return this._cmds[i].name;
            }
        }
        return "";
    }
    onDefaut(cmd) {
    }
    onConnect() {
        var c = new cmd.VerifyCmd();
        c.apply = { token: this._token };
        this.send(c);
    }
    onReconntct() {
    }
    start() {
    }
    onCode(cmd) {
        if (cmd.reply.err != "") {
            console.error(cmd.reply.err);
            alert(cmd.reply.err);
            return;
        }
    }
    onSignup(cmd) {
        if (cmd.reply.err != "") {
            console.error(cmd.reply.err);
            alert(cmd.reply.err);
            return;
        }
    }
    onSignin(cmd) {
        if (cmd.reply.err != "") {
            console.error(cmd.reply.err);
            alert(cmd.reply.err);
            return;
        }
        console.log("onSignin: ", cmd);
        this._addr = cmd.reply.addr;
        this._token = cmd.reply.token;
        if (cmd.reply.role == 0) {
            this._adapter.interfacer.onAdminer(this._addr, this._token);
        }
        else if (cmd.reply.role == 1) {
            this._adapter.interfacer.onTeacher(this._addr, this._token);
        }
        else if (cmd.reply.role == 2) {
            this._adapter.interfacer.onStudent(this._addr, this._token);
        }
    }
    onVerify(cmd) {
        var d = cmd.reply.info;
        console.log("onVerify: ", d);
        var adapter = this._adapter;
        adapter.onLoad(d);
        var v = d.teacher ? d.teacher : d.student ? d.student : d.adminer;
        adapter.interfacer.onUserInfo(v);
    }
    onEnterHall(cmd) {
        this._adapter.onEnterHall();
    }
    onStartClass(cmd) {
    }
    /*private onEnterClass(cmd: cmd.EnterClassCmd) {
        this._adapter.onEnterClass(cmd.reply);
    }*/
    onReadyClass(cmd) {
        this._adapter.onReadyClass(cmd.reply);
    }
    onJoinedClass(cmd) {
        this._adapter.onJoinedClass(cmd);
    }
    set url(v) {
        this._networker.url = v;
    }
    onMidi(cmd) {
        this._adapter.onMidi(JSON.parse(cmd.data));
    }
    onWebrtc(cmd) {
        this._adapter.onWebrtc(cmd.id, cmd.type, cmd.data);
    }
}
class StudentAdapter extends Adapter {
    constructor(service, interfacer) {
        super(service, interfacer);
    }
    onEnterHall() {
        this.initMidi();
        this.initWebrtc();
        //this.enterClass();
    }
    onReady() {
        //this.readyClass();
        this.enterClass();
    }
    /*public onEnterClass(data: cmd.EnterClassCmd.Reply) {
        //this._service.sendMidi({msg: "send midi ...."});
        //this.initMidi();
        //this.initWebrtc();
        this.readyClass();
    }*/
    onEstablish(id) {
        this._webrt.launch(id);
    }
}
class TeacherAdapter extends Adapter {
    constructor(service, interfacer) {
        super(service, interfacer);
    }
    onEnterHall() {
        this.initWebrtc();
    }
    onReady() {
        this.startClass();
    }
}
class Utils {
    static queryParam(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
        var r = window.location.search.substr(1).match(reg);
        if (r != null) {
            return r[2];
        }
        return null;
    }
}
class Webrtcer {
    constructor(adapter) {
        this._stream = null;
        this._peers = {};
        this._config = {
            iceServers: [{
                    urls: 'stun:stun.l.google.com:19302',
                }]
        };
        this._adapter = adapter;
    }
    get stream() {
        return this._stream;
    }
    init(initFunc) {
        var constraints = {
            video: {
                width: 320,
                height: 240
            },
            audio: {
                echoCancellation: true,
                noiseSupperssion: true,
                autoGainControl: true
            }
        };
        let self = this;
        let navigator = window.navigator;
        navigator.mediaDevices.getUserMedia(constraints)
            .then(function (stream) {
            self.onGetMediaStream(stream, initFunc);
        })
            .catch(function (err) {
            self.onHandleError(err);
        });
    }
    launch(id) {
        let wc = this._peers[id];
        if (wc) {
            wc.close();
        }
        wc = new WebrtcLocal(this, id);
        this._peers[id] = wc;
        wc.create();
    }
    onMessage(id, type, data) {
        if (type == "offer") {
            this.onOffer(id, data);
            this._adapter.onEstablish(id);
        }
        else if (type == "answer") {
            this.onAnswer(id, data);
        }
        else if (type == "candidate") {
            this.onCandidate(id, data);
        }
    }
    onOffer(id, sdp) {
        let wc = this._peers[id];
        if (wc) {
            wc.close();
        }
        wc = new WebrtcRemote(this, id);
        wc.create();
        this._peers[id] = wc;
        wc.onOffer(sdp);
    }
    onAnswer(id, sdp) {
        let wc = this._peers[id];
        if (!wc) {
            console.error("local is null: ", id);
        }
        else {
            wc.onAnswer(sdp);
        }
    }
    onCandidate(id, sdp) {
        let wc = this._peers[id];
        if (!wc) {
            console.error("candidate is null: ", id);
        }
        else {
            wc.onCandidate(new RTCIceCandidate(sdp));
        }
    }
    onGetMediaStream(stream, initFunc) {
        if (this._stream) {
            let self = this;
            stream.getAudioTracks().forEach((track) => {
                self._stream.addTrack(track);
                stream.removeTrack(track);
            });
        }
        else {
            this._stream = stream;
        }
        //localVideo.srcObject = localStream;
        if (initFunc) {
            initFunc();
        }
    }
    onHandleError(err) {
        console.error('Failed to get media stream: ', err);
    }
    sendCandidate(id, candidate) {
        this._adapter.sendWebrtc(id, "candidate", candidate);
    }
    sendOffer(id, sdp) {
        this._adapter.sendWebrtc(id, "offer", sdp);
    }
    sendAnswer(id, sdp) {
        this._adapter.sendWebrtc(id, "answer", sdp);
    }
    newRTCPeerConnection() {
        return new RTCPeerConnection(this._config);
    }
    onRemoteStream(id, stream) {
        this._adapter.interfacer.onRemoteStream(id, stream);
    }
}
class Webrtc {
    constructor(webrtc, id) {
        this._id = 0;
        this._pc = null; //PeerConnection
        this._webrtcer = webrtc;
        this._id = id;
    }
    close() {
        this._pc.close();
        this._pc = null;
    }
    create() {
        console.error("Webrtc::create");
    }
    onOffer(sdp) {
        console.error("Webrtc::onOffer");
    }
    onAnswer(sdp) {
        console.error("Webrtc::onAnswer");
    }
    onCandidate(candidate) {
        console.log("Webrtc::onCandidate: " + this._id);
        this._pc.addIceCandidate(candidate).then(() => {
            console.log("addIceCandidate success");
        }).catch((err) => {
            console.error("Error: Failure during addIceCandidate()");
        });
    }
    //PeerConnection
    createPeer() {
        console.log("Webrtc::createPeer: " + this._id);
        if (this._pc) {
            return;
        }
        let self = this;
        this._pc = self._webrtcer.newRTCPeerConnection();
        this._pc.onicecandidate = (e) => {
            if (e.candidate) {
                /*sendMessage(roomId, {
                        type: 'candidate',
                        label: e.candidate.sdpMLineIndex,
                        id: e.candidate.sdpMid,
                        candidate: e.candidate.candidate
                    });*/
                console.log("WebrtcLocal onicecandidate: " + self._id);
                self._webrtcer.sendCandidate(self._id, e.candidate);
            }
            else {
                console.log("end candidate");
            }
        };
    }
}
class WebrtcLocal extends Webrtc {
    constructor(webrtc, id) {
        super(webrtc, id);
    }
    create() {
        //PeerConnection
        this.createPeer();
        //track
        this.bindTracks();
        this.startCall();
    }
    startCall() {
        let offerOptions = {
            offerToRecieveAudio: 1,
            offerToRecieveVideo: 1
        };
        let self = this;
        this._pc.createOffer(offerOptions).then((sdp) => {
            self.onGetOffer(sdp);
        }).catch((err) => {
            console.error('create offer failed: ', err);
        });
    }
    bindTracks() {
        console.log("WebrtcLocal bindTracks: " + this._id);
        if (this._pc === null || this._webrtcer.stream === null || this._webrtcer.stream === undefined) {
            console.error('pc or localStream is null or undefined');
            return;
        }
        let self = this;
        this._webrtcer.stream.getTracks().forEach((track) => {
            self._pc.addTrack(track, self._webrtcer.stream);
            console.log("WebrtcLocal addTrack: " + self._id);
        });
        console.log("WebrtcLocal bindTracks finish: " + this._id);
    }
    onGetOffer(sdp) {
        console.log("WebrtcLocal::onGetOffer: " + this._id);
        this._pc.setLocalDescription(sdp);
        this._webrtcer.sendOffer(this._id, sdp);
    }
    onAnswer(sdp) {
        console.log("WebrtcLocal::onAnswer: " + this._id);
        this._pc.setRemoteDescription(new RTCSessionDescription(sdp));
    }
}
class WebrtcRemote extends Webrtc {
    constructor(webrtc, id) {
        super(webrtc, id);
    }
    create() {
        //PeerConnection
        this.createPeer();
        let self = this;
        this._pc.ontrack = function (e) {
            self.onGetRemoteStream(e);
        };
    }
    onGetRemoteStream(e) {
        console.log("WebrtcRemote::onGetRemoteStream: " + this._id);
        this._webrtcer.onRemoteStream(this._id, e.streams[0]);
    }
    onOffer(sdp) {
        console.log("WebrtcRemote::onOffer: " + this._id);
        this._pc.setRemoteDescription(new RTCSessionDescription(sdp));
        let self = this;
        //anwser
        this._pc.createAnswer().then((sdp) => {
            self.onGetAnswer(sdp);
        }).catch((err) => {
            console.error('create answer failed: ', err);
        });
    }
    onGetAnswer(sdp) {
        console.log("WebrtcRemote::onGetAnswer: " + this._id);
        this._pc.setLocalDescription(sdp);
        this._webrtcer.sendAnswer(this._id, sdp);
    }
}
var midi;
(function (midi) {
    class Editor {
        create(div, cnt) {
            div.innerHTML = "";
            this._rows = new Array();
            var confs = midi.Utils.confs;
            for (let i = 0, l = confs.length; i < l; i++) {
                var cols = this.createCols(div, confs[i], cnt);
                this._rows.push({ conf: confs[i], cols: cols });
            }
        }
        load(div, data) {
            var ns = core.midiToSequenceProto(data);
            var qpm = ns.tempos[0].qpm;
            var delta = Editor._deltaTime;
            var cnt = ns.totalTime / delta;
            this.create(div, cnt);
            var confs = midi.Utils.confs;
            for (var i = 0, l = ns.notes.length; i < l; i++) {
                var n = ns.notes[i];
                var idx = this.idx(n.pitch);
                var b = n.startTime / delta;
                var e = n.endTime / delta;
                for (; b < e; b++) {
                    this._rows[idx].cols[b].value = 1;
                    this.show(this._rows[idx].cols[b]);
                }
            }
        }
        idx(value) {
            for (var i = 0, l = midi.Utils.confs.length; i < l; i++) {
                var c = midi.Utils.confs[i];
                if (c.value == value) {
                    return i;
                }
            }
            return -1;
        }
        clear() {
            for (let i = 0, l = this._rows.length; i < l; i++) {
                let r = this._rows[i];
                for (let j = 0, s = r.cols.length; j < s; j++) {
                    r.cols[j].value = 0;
                    r.cols[j].src = 'images/button_off.png';
                }
            }
        }
        createCols(pad, conf, cnt) {
            var div = document.createElement('div');
            div.className = 'buttons_row';
            pad.appendChild(div);
            var span = document.createElement('span');
            span.className = 'label';
            span.innerHTML = conf.name;
            div.appendChild(span);
            var self = this;
            var func = function (e) {
                self.onMouseDown(e);
            };
            var arr = new Array();
            for (let i = 0; i < cnt; i++) {
                var img = document.createElement('img');
                img.className = 'btn';
                img['conf'] = conf;
                img['value'] = 0;
                img.setAttribute("src", 'images/button_off.png');
                img.addEventListener("mousedown", func, true);
                div.appendChild(img);
                arr.push(img);
            }
            return arr;
        }
        onMouseDown(event) {
            var btn = event.target;
            //btn.value = (btn.value + 1) % 3;
            btn.value = (btn.value + 1) % 2;
            this.show(btn);
        }
        show(btn) {
            switch (btn.value) {
                case 0:
                    btn.src = 'images/button_off.png';
                    break;
                case 1:
                    btn.src = 'images/button_half.png';
                    break;
                case 2:
                    btn.src = 'images/button_on.png';
                    break;
            }
        }
        save() {
            var ns = core.sequences.createQuantizedNoteSequence(4, 120);
            ns.quantizationInfo = null;
            ns.ticksPerQuarter = 100;
            ns.timeSignatures = [{ time: 0, numerator: 4, denominator: 4 }];
            ns.tempos = [{ time: 0, qpm: 120 }];
            ns.notes = [];
            ns.sourceInfo = { encodingType: 'MIDI', parser: 'TONEJS_MIDI_CONVERT' };
            this.fill(ns);
            var data = core.sequenceProtoToMidi(ns);
            return data;
        }
        fill(ns) {
            var rows = this._rows;
            var l = rows[0].cols.length;
            var delta = Editor._deltaTime, startTime = 0, endTime = 0;
            for (var i = 0; i < l; i++) {
                endTime = startTime + delta;
                for (var j = 0, r = rows.length; j < r; j++) {
                    var value = rows[j].cols[i].value;
                    if (value == 0) {
                        continue;
                    }
                    var n = {
                        pitch: rows[j].conf.value,
                        velocity: 80,
                        startTime: startTime,
                        endTime: endTime,
                        instrument: 0,
                        program: 0,
                        isDrum: true
                    };
                    ns.notes.push(n);
                }
                startTime = endTime;
            }
            ns.totalTime = endTime;
        }
    }
    Editor._deltaTime = 0.125 * 2;
    midi.Editor = Editor;
})(midi || (midi = {}));
var midi;
(function (midi) {
    function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
        try {
            var info = gen[key](arg);
            var value = info.value;
        }
        catch (error) {
            reject(error);
            return;
        }
        if (info.done) {
            resolve(value);
        }
        else {
            Promise.resolve(value).then(_next, _throw);
        }
    }
    function _asyncToGenerator(fn) {
        return function () {
            var self = this, args = arguments;
            return new Promise(function (resolve, reject) {
                var gen = fn.apply(self, args);
                function _next(value) {
                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
                }
                function _throw(err) {
                    asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
                }
                _next(undefined);
            });
        };
    }
    class Player {
        constructor(noteCallback) {
            this._player = null;
            this._soundFont = "";
            this._noteSequence = null;
            this._noteCallback = null;
            this._config = {};
            this._note = {};
            this._noteCallback = noteCallback;
        }
        load(data, load) {
            this._noteSequence = core.midiToSequenceProto(data);
            var self = this;
            return _asyncToGenerator(function* () {
                var soundFont = self._soundFont;
                var callbackObject = {
                    // Call callbacks only if we are still playing the same note sequence.
                    run: n => self.onNote(n),
                    stop: () => { }
                };
                if (soundFont === null) {
                    self._player = new core.Player(false, callbackObject);
                }
                else {
                    if (soundFont === "") {
                        soundFont = Player.DEFAULT_SOUNDFONT;
                    }
                    self._player = new core.SoundFontPlayer(soundFont, undefined, undefined, undefined, callbackObject);
                    yield self._player.loadSamples(self._noteSequence);
                }
                //_this.unfreeze();
                load();
                self.onLoad();
            })();
        }
        onLoad() {
        }
        onNote(note) {
            this._note = note;
            console.log("onNote.....");
            this._noteCallback(note);
        }
        get tempo() {
            return this._noteSequence.tempos[0].qpm;
        }
        set tempo(v) {
            this._player.setTempo(v);
        }
        play() {
            this._player.start(this._noteSequence);
            //this._player.setTempo(240);
        }
        stop() {
            this._player.stop();
        }
        pause() {
            this._player.pause();
        }
        resume() {
            this._player.resume();
        }
    }
    Player.DEFAULT_SOUNDFONT = 'https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus';
    midi.Player = Player;
})(midi || (midi = {}));
var midi;
(function (midi) {
    class Utils {
    }
    Utils.KICK = 36;
    Utils.SNARE = 38;
    Utils.SNARE_RIM = 40;
    Utils.TOM_1 = 48;
    Utils.TOM_1_RIM = 50;
    Utils.TOM_2 = 43;
    Utils.TOM_2_RIM = 58;
    Utils.TOM_3 = 41;
    Utils.TOM_3_RIM = 39;
    Utils.HI_HAT_PEDAL = 4;
    Utils.HI_HAT = 46;
    Utils.CRASH_LEFT = 55;
    Utils.CRASH_LEFT_BELL = 49;
    Utils.CRASH_RIGHT = 52;
    Utils.CRASH_RIGHT_BELL = 57;
    Utils.RIDE_EDGE = 59;
    Utils.RIDE = 51;
    Utils.RIDE_BELL = 53;
    Utils.confs = [
        { id: "kick", name: "Kick", value: Utils.KICK },
        { id: "snare", name: "Snare", value: Utils.SNARE },
        { id: "tom1", name: "Tom 1", value: Utils.TOM_1 },
        { id: "tom2", name: "Tom 2", value: Utils.TOM_2 },
        { id: "tom3", name: "Tom 3", value: Utils.TOM_3 },
        { id: "hihat", name: "Hi-Hat", value: Utils.HI_HAT },
        { id: "crash_left", name: "Crash-Left", value: Utils.CRASH_LEFT },
        { id: "crash_right", name: "Crash-Right", value: Utils.CRASH_RIGHT },
        { id: "ride", name: "Ride", value: Utils.RIDE },
    ];
    midi.Utils = Utils;
})(midi || (midi = {}));
/**
 * The Endian class contains values that denote the byte order used to represent multibyte numbers.
 * The byte order is either bigEndian (most significant byte first) or littleEndian (least significant byte first).
 * @version Egret 2.4
 * @platform Web,Native
 * @language en_US
 */
/**
 * Endian 
 *  bigEndian littleEndian
 * @version Egret 2.4
 * @platform Web,Native
 * @language zh_CN
 */
class Endian {
}
/**
 * Indicates the least significant byte of the multibyte number appears first in the sequence of bytes.
 * The hexadecimal number 0x12345678 has 4 bytes (2 hexadecimal digits per byte). The most significant byte is 0x12. The least significant byte is 0x78. (For the equivalent decimal number, 305419896, the most significant digit is 3, and the least significant digit is 6).
 * @version Egret 2.4
 * @platform Web,Native
 * @language en_US
 */
/**
 * 
 *  0x12345678  4  2  0x12 0x78 305419896 3 6
 * @version Egret 2.4
 * @platform Web,Native
 * @language zh_CN
 */
Endian.LITTLE_ENDIAN = "littleEndian";
/**
 * Indicates the most significant byte of the multibyte number appears first in the sequence of bytes.
 * The hexadecimal number 0x12345678 has 4 bytes (2 hexadecimal digits per byte).  The most significant byte is 0x12. The least significant byte is 0x78. (For the equivalent decimal number, 305419896, the most significant digit is 3, and the least significant digit is 6).
 * @version Egret 2.4
 * @platform Web,Native
 * @language en_US
 */
/**
 * 
 *  0x12345678  4  2  0x12 0x78 305419896 3 6
 * @version Egret 2.4
 * @platform Web,Native
 * @language zh_CN
 */
Endian.BIG_ENDIAN = "bigEndian";
/**
 * The ByteArray class provides methods and attributes for optimized reading and writing as well as dealing with binary data.
 * Note: The ByteArray class is applied to the advanced developers who need to access data at the byte layer.
 * @version Egret 2.4
 * @platform Web,Native
 * @includeExample egret/utils/ByteArray.ts
 * @language en_US
 */
/**
 * ByteArray 
 * ByteArray 
 * @version Egret 2.4
 * @platform Web,Native
 * @includeExample egret/utils/ByteArray.ts
 * @language zh_CN
 */
class ByteArray {
    /**
     * @version Egret 2.4
     * @platform Web,Native
     */
    constructor(buffer, bufferExtSize = 0) {
        /**
         * @private
         */
        this.bufferExtSize = 0; //Buffer expansion size
        /**
         * @private
         */
        this.EOF_byte = -1;
        /**
         * @private
         */
        this.EOF_code_point = -1;
        if (bufferExtSize < 0) {
            bufferExtSize = 0;
        }
        this.bufferExtSize = bufferExtSize;
        let bytes, wpos = 0;
        if (buffer) { //
            let uint8;
            if (buffer instanceof Uint8Array) {
                uint8 = buffer;
                wpos = buffer.length;
            }
            else {
                wpos = buffer.byteLength;
                uint8 = new Uint8Array(buffer);
            }
            if (bufferExtSize == 0) {
                bytes = new Uint8Array(wpos);
            }
            else {
                let multi = (wpos / bufferExtSize | 0) + 1;
                bytes = new Uint8Array(multi * bufferExtSize);
            }
            bytes.set(uint8);
        }
        else {
            bytes = new Uint8Array(bufferExtSize);
        }
        this.write_position = wpos;
        this._position = 0;
        this._bytes = bytes;
        this.data = new DataView(bytes.buffer);
        this.endian = Endian.BIG_ENDIAN;
    }
    /**
     * Changes or reads the byte order; egret.EndianConst.BIG_ENDIAN or egret.EndianConst.LITTLE_EndianConst.
     * @default egret.EndianConst.BIG_ENDIAN
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * egret.EndianConst.BIG_ENDIAN  egret.EndianConst.LITTLE_ENDIAN
     * @default egret.EndianConst.BIG_ENDIAN
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    get endian() {
        return this.$endian == 0 /* LITTLE_ENDIAN */ ? Endian.LITTLE_ENDIAN : Endian.BIG_ENDIAN;
    }
    set endian(value) {
        this.$endian = value == Endian.LITTLE_ENDIAN ? 0 /* LITTLE_ENDIAN */ : 1 /* BIG_ENDIAN */;
    }
    /**
     * @deprecated
     * @version Egret 2.4
     * @platform Web,Native
     */
    setArrayBuffer(buffer) {
    }
    /**
     * 
     *
     * @returns
     *
     * @memberOf ByteArray
     */
    get readAvailable() {
        return this.write_position - this._position;
    }
    get buffer() {
        return this.data.buffer.slice(0, this.write_position);
    }
    get rawBuffer() {
        return this.data.buffer;
    }
    /**
     * @private
     */
    set buffer(value) {
        let wpos = value.byteLength;
        let uint8 = new Uint8Array(value);
        let bufferExtSize = this.bufferExtSize;
        let bytes;
        if (bufferExtSize == 0) {
            bytes = new Uint8Array(wpos);
        }
        else {
            let multi = (wpos / bufferExtSize | 0) + 1;
            bytes = new Uint8Array(multi * bufferExtSize);
        }
        bytes.set(uint8);
        this.write_position = wpos;
        this._bytes = bytes;
        this.data = new DataView(bytes.buffer);
    }
    get bytes() {
        return this._bytes;
    }
    /**
     * @private
     * @version Egret 2.4
     * @platform Web,Native
     */
    get dataView() {
        return this.data;
    }
    /**
     * @private
     */
    set dataView(value) {
        this.buffer = value.buffer;
    }
    /**
     * @private
     */
    get bufferOffset() {
        return this.data.byteOffset;
    }
    /**
     * The current position of the file pointer (in bytes) to move or return to the ByteArray object. The next time you start reading reading method call in this position, or will start writing in this position next time call a write method.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  ByteArray 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    get position() {
        return this._position;
    }
    set position(value) {
        this._position = value;
        if (value > this.write_position) {
            this.write_position = value;
        }
    }
    /**
     * The length of the ByteArray object (in bytes).
              * If the length is set to be larger than the current length, the right-side zero padding byte array.
              * If the length is set smaller than the current length, the byte array is truncated.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * ByteArray 
     * 
     * 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    get length() {
        return this.write_position;
    }
    set length(value) {
        this.write_position = value;
        if (this.data.byteLength > value) {
            this._position = value;
        }
        this._validateBuffer(value);
    }
    _validateBuffer(value) {
        if (this.data.byteLength < value) {
            let be = this.bufferExtSize;
            let tmp;
            if (be == 0) {
                tmp = new Uint8Array(value);
            }
            else {
                let nLen = ((value / be >> 0) + 1) * be;
                tmp = new Uint8Array(nLen);
            }
            tmp.set(this._bytes);
            this._bytes = tmp;
            this.data = new DataView(tmp.buffer);
        }
    }
    /**
     * The number of bytes that can be read from the current position of the byte array to the end of the array data.
     * When you access a ByteArray object, the bytesAvailable property in conjunction with the read methods each use to make sure you are reading valid data.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * 
     *  ByteArray  bytesAvailable 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    get bytesAvailable() {
        return this.data.byteLength - this._position;
    }
    /**
     * Clears the contents of the byte array and resets the length and position properties to 0.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  length  position  0
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    clear() {
        let buffer = new ArrayBuffer(this.bufferExtSize);
        this.data = new DataView(buffer);
        this._bytes = new Uint8Array(buffer);
        this._position = 0;
        this.write_position = 0;
    }
    /**
     * Read a Boolean value from the byte stream. Read a simple byte. If the byte is non-zero, it returns true; otherwise, it returns false.
     * @return If the byte is non-zero, it returns true; otherwise, it returns false.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  true false
     * @return  true false
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readBoolean() {
        if (this.validate(1 /* SIZE_OF_BOOLEAN */))
            return !!this._bytes[this.position++];
    }
    /**
     * Read signed bytes from the byte stream.
     * @return An integer ranging from -128 to 127
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * 
     * @return  -128  127 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readByte() {
        if (this.validate(1 /* SIZE_OF_INT8 */))
            return this.data.getInt8(this.position++);
    }
    /**
     * Read data byte number specified by the length parameter from the byte stream. Starting from the position specified by offset, read bytes into the ByteArray object specified by the bytes parameter, and write bytes into the target ByteArray
     * @param bytes ByteArray object that data is read into
     * @param offset Offset (position) in bytes. Read data should be written from this position
     * @param length Byte number to be read Default value 0 indicates reading all available data
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  length  offset  bytes  ByteArray  ByteArray 
     * @param bytes  ByteArray 
     * @param offset bytes 
     * @param length  0 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readBytes(bytes, offset = 0, length = 0) {
        if (!bytes) { //bytesnew
            return;
        }
        let pos = this._position;
        let available = this.write_position - pos;
        if (available < 0) {
            console.error(1025);
            return;
        }
        if (length == 0) {
            length = available;
        }
        else if (length > available) {
            console.error(1025);
            return;
        }
        const position = bytes._position;
        bytes._position = 0;
        bytes.validateBuffer(offset + length);
        bytes._position = position;
        bytes._bytes.set(this._bytes.subarray(pos, pos + length), offset);
        this.position += length;
    }
    /**
     * Read an IEEE 754 double-precision (64 bit) floating point number from the byte stream
     * @return Double-precision (64 bit) floating point number
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  IEEE 754 64 
     * @return 64 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readDouble() {
        if (this.validate(8 /* SIZE_OF_FLOAT64 */)) {
            let value = this.data.getFloat64(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 8 /* SIZE_OF_FLOAT64 */;
            return value;
        }
    }
    /**
     * Read an IEEE 754 single-precision (32 bit) floating point number from the byte stream
     * @return Single-precision (32 bit) floating point number
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  IEEE 754 32 
     * @return 32 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readFloat() {
        if (this.validate(4 /* SIZE_OF_FLOAT32 */)) {
            let value = this.data.getFloat32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 4 /* SIZE_OF_FLOAT32 */;
            return value;
        }
    }
    /**
     * Read a 32-bit signed integer from the byte stream.
     * @return A 32-bit signed integer ranging from -2147483648 to 2147483647
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  32 
     * @return  -2147483648  2147483647  32 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readInt() {
        if (this.validate(4 /* SIZE_OF_INT32 */)) {
            let value = this.data.getInt32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 4 /* SIZE_OF_INT32 */;
            return value;
        }
    }
    /**
     * Read a 16-bit signed integer from the byte stream.
     * @return A 16-bit signed integer ranging from -32768 to 32767
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  16 
     * @return  -32768  32767  16 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readShort() {
        if (this.validate(2 /* SIZE_OF_INT16 */)) {
            let value = this.data.getInt16(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 2 /* SIZE_OF_INT16 */;
            return value;
        }
    }
    /**
     * Read unsigned bytes from the byte stream.
     * @return A unsigned integer ranging from 0 to 255
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * 
     * @return  0  255 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readUnsignedByte() {
        if (this.validate(1 /* SIZE_OF_UINT8 */))
            return this._bytes[this.position++];
    }
    /**
     * Read a 32-bit unsigned integer from the byte stream.
     * @return A 32-bit unsigned integer ranging from 0 to 4294967295
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  32 
     * @return  0  4294967295  32 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readUnsignedInt() {
        if (this.validate(4 /* SIZE_OF_UINT32 */)) {
            let value = this.data.getUint32(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 4 /* SIZE_OF_UINT32 */;
            return value;
        }
    }
    /**
     * Read a 16-bit unsigned integer from the byte stream.
     * @return A 16-bit unsigned integer ranging from 0 to 65535
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  16 
     * @return  0  65535  16 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readUnsignedShort() {
        if (this.validate(2 /* SIZE_OF_UINT16 */)) {
            let value = this.data.getUint16(this._position, this.$endian == 0 /* LITTLE_ENDIAN */);
            this.position += 2 /* SIZE_OF_UINT16 */;
            return value;
        }
    }
    /**
     * Read a UTF-8 character string from the byte stream Assume that the prefix of the character string is a short unsigned integer (use byte to express length)
     * @return UTF-8 character string
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  UTF-8 
     * @return UTF-8 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readUTF() {
        let length = this.readUnsignedShort();
        if (length > 0) {
            return this.readUTFBytes(length);
        }
        else {
            return "";
        }
    }
    /**
     * Read a UTF-8 byte sequence specified by the length parameter from the byte stream, and then return a character string
     * @param Specify a short unsigned integer of the UTF-8 byte length
     * @return A character string consists of UTF-8 bytes of the specified length
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  length  UTF-8 
     * @param length  UTF-8 
     * @return  UTF-8 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    readUTFBytes(length) {
        if (!this.validate(length)) {
            return;
        }
        let data = this.data;
        let bytes = new Uint8Array(data.buffer, data.byteOffset + this._position, length);
        this.position += length;
        return this.decodeUTF8(bytes);
    }
    /**
     * Write a Boolean value. A single byte is written according to the value parameter. If the value is true, write 1; if the value is false, write 0.
     * @param value A Boolean value determining which byte is written. If the value is true, write 1; if the value is false, write 0.
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  value  true 1 false 0
     * @param value  true 1 false 0
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeBoolean(value) {
        this.validateBuffer(1 /* SIZE_OF_BOOLEAN */);
        this._bytes[this.position++] = +value;
    }
    /**
     * Write a byte into the byte stream
     * The low 8 bits of the parameter are used. The high 24 bits are ignored.
     * @param value A 32-bit integer. The low 8 bits will be written into the byte stream
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     * 
     *  8  24 
     * @param value  32  8 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeByte(value) {
        this.validateBuffer(1 /* SIZE_OF_INT8 */);
        this._bytes[this.position++] = value & 0xff;
    }
    /**
     * Write the byte sequence that includes length bytes in the specified byte array, bytes, (starting at the byte specified by offset, using a zero-based index), into the byte stream
     * If the length parameter is omitted, the default length value 0 is used and the entire buffer starting at offset is written. If the offset parameter is also omitted, the entire buffer is written
     * If the offset or length parameter is out of range, they are clamped to the beginning and end of the bytes array.
     * @param bytes ByteArray Object
     * @param offset A zero-based index specifying the position into the array to begin writing
     * @param length An unsigned integer specifying how far into the buffer to write
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  bytes offset length 
     *  length  0 offset  offset 
     *  offset  length  bytes 
     * @param bytes ByteArray 
     * @param offset  0 
     * @param length 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeBytes(bytes, offset = 0, length = 0) {
        let writeLength;
        if (offset < 0) {
            return;
        }
        if (length < 0) {
            return;
        }
        else if (length == 0) {
            writeLength = bytes.length - offset;
        }
        else {
            writeLength = Math.min(bytes.length - offset, length);
        }
        if (writeLength > 0) {
            this.validateBuffer(writeLength);
            this._bytes.set(bytes._bytes.subarray(offset, offset + writeLength), this._position);
            this.position = this._position + writeLength;
        }
    }
    /**
     * Write an IEEE 754 double-precision (64 bit) floating point number into the byte stream
     * @param value Double-precision (64 bit) floating point number
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  IEEE 754 64 
     * @param value 64 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeDouble(value) {
        this.validateBuffer(8 /* SIZE_OF_FLOAT64 */);
        this.data.setFloat64(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 8 /* SIZE_OF_FLOAT64 */;
    }
    /**
     * Write an IEEE 754 single-precision (32 bit) floating point number into the byte stream
     * @param value Single-precision (32 bit) floating point number
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  IEEE 754 32 
     * @param value 32 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeFloat(value) {
        this.validateBuffer(4 /* SIZE_OF_FLOAT32 */);
        this.data.setFloat32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 4 /* SIZE_OF_FLOAT32 */;
    }
    /**
     * Write a 32-bit signed integer into the byte stream
     * @param value An integer to be written into the byte stream
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  32 
     * @param value 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeInt(value) {
        this.validateBuffer(4 /* SIZE_OF_INT32 */);
        this.data.setInt32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 4 /* SIZE_OF_INT32 */;
    }
    /**
     * Write a 16-bit integer into the byte stream. The low 16 bits of the parameter are used. The high 16 bits are ignored.
     * @param value A 32-bit integer. Its low 16 bits will be written into the byte stream
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  16  16  16 
     * @param value 32  16 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeShort(value) {
        this.validateBuffer(2 /* SIZE_OF_INT16 */);
        this.data.setInt16(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 2 /* SIZE_OF_INT16 */;
    }
    /**
     * Write a 32-bit unsigned integer into the byte stream
     * @param value An unsigned integer to be written into the byte stream
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  32 
     * @param value 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeUnsignedInt(value) {
        this.validateBuffer(4 /* SIZE_OF_UINT32 */);
        this.data.setUint32(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 4 /* SIZE_OF_UINT32 */;
    }
    /**
     * Write a 16-bit unsigned integer into the byte stream
     * @param value An unsigned integer to be written into the byte stream
     * @version Egret 2.5
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  16 
     * @param value 
     * @version Egret 2.5
     * @platform Web,Native
     * @language zh_CN
     */
    writeUnsignedShort(value) {
        this.validateBuffer(2 /* SIZE_OF_UINT16 */);
        this.data.setUint16(this._position, value, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 2 /* SIZE_OF_UINT16 */;
    }
    /**
     * Write a UTF-8 string into the byte stream. The length of the UTF-8 string in bytes is written first, as a 16-bit integer, followed by the bytes representing the characters of the string
     * @param value Character string value to be written
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  UTF-8  UTF-8  16 
     * @param value 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeUTF(value) {
        let utf8bytes = this.encodeUTF8(value);
        let length = utf8bytes.length;
        this.validateBuffer(2 /* SIZE_OF_UINT16 */ + length);
        this.data.setUint16(this._position, length, this.$endian == 0 /* LITTLE_ENDIAN */);
        this.position += 2 /* SIZE_OF_UINT16 */;
        this._writeUint8Array(utf8bytes, false);
    }
    /**
     * Write a UTF-8 string into the byte stream. Similar to the writeUTF() method, but the writeUTFBytes() method does not prefix the string with a 16-bit length word
     * @param value Character string value to be written
     * @version Egret 2.4
     * @platform Web,Native
     * @language en_US
     */
    /**
     *  UTF-8  writeUTF()  writeUTFBytes()  16 
     * @param value 
     * @version Egret 2.4
     * @platform Web,Native
     * @language zh_CN
     */
    writeUTFBytes(value) {
        this._writeUint8Array(this.encodeUTF8(value));
    }
    /**
     *
     * @returns
     * @version Egret 2.4
     * @platform Web,Native
     */
    toString() {
        return "[ByteArray] length:" + this.length + ", bytesAvailable:" + this.bytesAvailable;
    }
    /**
     * @private
     *  Uint8Array 
     * @param bytes Uint8Array
     * @param validateBuffer
     */
    _writeUint8Array(bytes, validateBuffer = true) {
        let pos = this._position;
        let npos = pos + bytes.length;
        if (validateBuffer) {
            this.validateBuffer(npos);
        }
        this.bytes.set(bytes, pos);
        this.position = npos;
    }
    /**
     * @param len
     * @returns
     * @version Egret 2.4
     * @platform Web,Native
     * @private
     */
    validate(len) {
        let bl = this._bytes.length;
        if (bl > 0 && this._position + len <= bl) {
            return true;
        }
        else {
            console.error(1025);
        }
    }
    /**********************/
    /*  PRIVATE METHODS   */
    /**********************/
    /**
     * @private
     * @param len
     * @param needReplace
     */
    validateBuffer(len) {
        this.write_position = len > this.write_position ? len : this.write_position;
        len += this._position;
        this._validateBuffer(len);
    }
    /**
     * @private
     * UTF-8 Encoding/Decoding
     */
    encodeUTF8(str) {
        let pos = 0;
        let codePoints = this.stringToCodePoints(str);
        let outputBytes = [];
        while (codePoints.length > pos) {
            let code_point = codePoints[pos++];
            if (this.inRange(code_point, 0xD800, 0xDFFF)) {
                this.encoderError(code_point);
            }
            else if (this.inRange(code_point, 0x0000, 0x007f)) {
                outputBytes.push(code_point);
            }
            else {
                let count, offset;
                if (this.inRange(code_point, 0x0080, 0x07FF)) {
                    count = 1;
                    offset = 0xC0;
                }
                else if (this.inRange(code_point, 0x0800, 0xFFFF)) {
                    count = 2;
                    offset = 0xE0;
                }
                else if (this.inRange(code_point, 0x10000, 0x10FFFF)) {
                    count = 3;
                    offset = 0xF0;
                }
                outputBytes.push(this.div(code_point, Math.pow(64, count)) + offset);
                while (count > 0) {
                    let temp = this.div(code_point, Math.pow(64, count - 1));
                    outputBytes.push(0x80 + (temp % 64));
                    count -= 1;
                }
            }
        }
        return new Uint8Array(outputBytes);
    }
    /**
     * @private
     *
     * @param data
     * @returns
     */
    decodeUTF8(data) {
        let fatal = false;
        let pos = 0;
        let result = "";
        let code_point;
        let utf8_code_point = 0;
        let utf8_bytes_needed = 0;
        let utf8_bytes_seen = 0;
        let utf8_lower_boundary = 0;
        while (data.length > pos) {
            let _byte = data[pos++];
            if (_byte == this.EOF_byte) {
                if (utf8_bytes_needed != 0) {
                    code_point = this.decoderError(fatal);
                }
                else {
                    code_point = this.EOF_code_point;
                }
            }
            else {
                if (utf8_bytes_needed == 0) {
                    if (this.inRange(_byte, 0x00, 0x7F)) {
                        code_point = _byte;
                    }
                    else {
                        if (this.inRange(_byte, 0xC2, 0xDF)) {
                            utf8_bytes_needed = 1;
                            utf8_lower_boundary = 0x80;
                            utf8_code_point = _byte - 0xC0;
                        }
                        else if (this.inRange(_byte, 0xE0, 0xEF)) {
                            utf8_bytes_needed = 2;
                            utf8_lower_boundary = 0x800;
                            utf8_code_point = _byte - 0xE0;
                        }
                        else if (this.inRange(_byte, 0xF0, 0xF4)) {
                            utf8_bytes_needed = 3;
                            utf8_lower_boundary = 0x10000;
                            utf8_code_point = _byte - 0xF0;
                        }
                        else {
                            this.decoderError(fatal);
                        }
                        utf8_code_point = utf8_code_point * Math.pow(64, utf8_bytes_needed);
                        code_point = null;
                    }
                }
                else if (!this.inRange(_byte, 0x80, 0xBF)) {
                    utf8_code_point = 0;
                    utf8_bytes_needed = 0;
                    utf8_bytes_seen = 0;
                    utf8_lower_boundary = 0;
                    pos--;
                    code_point = this.decoderError(fatal, _byte);
                }
                else {
                    utf8_bytes_seen += 1;
                    utf8_code_point = utf8_code_point + (_byte - 0x80) * Math.pow(64, utf8_bytes_needed - utf8_bytes_seen);
                    if (utf8_bytes_seen !== utf8_bytes_needed) {
                        code_point = null;
                    }
                    else {
                        let cp = utf8_code_point;
                        let lower_boundary = utf8_lower_boundary;
                        utf8_code_point = 0;
                        utf8_bytes_needed = 0;
                        utf8_bytes_seen = 0;
                        utf8_lower_boundary = 0;
                        if (this.inRange(cp, lower_boundary, 0x10FFFF) && !this.inRange(cp, 0xD800, 0xDFFF)) {
                            code_point = cp;
                        }
                        else {
                            code_point = this.decoderError(fatal, _byte);
                        }
                    }
                }
            }
            //Decode string
            if (code_point !== null && code_point !== this.EOF_code_point) {
                if (code_point <= 0xFFFF) {
                    if (code_point > 0)
                        result += String.fromCharCode(code_point);
                }
                else {
                    code_point -= 0x10000;
                    result += String.fromCharCode(0xD800 + ((code_point >> 10) & 0x3ff));
                    result += String.fromCharCode(0xDC00 + (code_point & 0x3ff));
                }
            }
        }
        return result;
    }
    /**
     * @private
     *
     * @param code_point
     */
    encoderError(code_point) {
        console.error(1026, code_point);
    }
    /**
     * @private
     *
     * @param fatal
     * @param opt_code_point
     * @returns
     */
    decoderError(fatal, opt_code_point) {
        if (fatal) {
            console.error(1027);
        }
        return opt_code_point || 0xFFFD;
    }
    /**
     * @private
     *
     * @param a
     * @param min
     * @param max
     */
    inRange(a, min, max) {
        return min <= a && a <= max;
    }
    /**
     * @private
     *
     * @param n
     * @param d
     */
    div(n, d) {
        return Math.floor(n / d);
    }
    /**
     * @private
     *
     * @param string
     */
    stringToCodePoints(string) {
        /** @type {Array.<number>} */
        let cps = [];
        // Based on http://www.w3.org/TR/WebIDL/#idl-DOMString
        let i = 0, n = string.length;
        while (i < string.length) {
            let c = string.charCodeAt(i);
            if (!this.inRange(c, 0xD800, 0xDFFF)) {
                cps.push(c);
            }
            else if (this.inRange(c, 0xDC00, 0xDFFF)) {
                cps.push(0xFFFD);
            }
            else { // (inRange(c, 0xD800, 0xDBFF))
                if (i == n - 1) {
                    cps.push(0xFFFD);
                }
                else {
                    let d = string.charCodeAt(i + 1);
                    if (this.inRange(d, 0xDC00, 0xDFFF)) {
                        let a = c & 0x3FF;
                        let b = d & 0x3FF;
                        i += 1;
                        cps.push(0x10000 + (a << 10) + b);
                    }
                    else {
                        cps.push(0xFFFD);
                    }
                }
            }
            i += 1;
        }
        return cps;
    }
}
class Crc {
    constructor() {
        this.table = [];
        this.poly = 0xEDB88320; // reverse polynomial
    }
    // build the table
    makeTable() {
        var c;
        var n;
        var k;
        for (n = 0; n < 256; n += 1) {
            c = n;
            for (k = 0; k < 8; k += 1) {
                if (c & 1) {
                    c = this.poly ^ (c >>> 1);
                }
                else {
                    c = c >>> 1;
                }
            }
            this.table[n] = c >>> 0;
        }
    }
    strToArr(str) {
        // sweet hack to turn string into a 'byte' array
        return Array.prototype.map.call(str, function (c) {
            return c.charCodeAt(0);
        });
    }
    /*
    * Compute CRC of array directly.
    *
    * This is slower for repeated calls, so append mode is not supported.
    */
    crcDirect(arr) {
        var crc = -1, // initial contents of LFBSR
        i, j, l, temp;
        for (i = 0, l = arr.length; i < l; i += 1) {
            temp = (crc ^ arr[i]) & 0xff;
            // read 8 bits one at a time
            for (j = 0; j < 8; j += 1) {
                if ((temp & 1) === 1) {
                    temp = (temp >>> 1) ^ this.poly;
                }
                else {
                    temp = (temp >>> 1);
                }
            }
            crc = (crc >>> 8) ^ temp;
        }
        // flip bits
        return crc ^ -1;
    }
    crc32(str) {
        var crc = 0;
        var arr = this.strToArr(str);
        crc = 0 ^ -1;
        for (var i = 0, l = arr.length; i < l; i += 1) {
            crc = (crc >>> 8) ^ this.table[(crc ^ arr[i]) & 0xff];
        }
        crc = crc ^ -1;
        return crc >>> 0;
    }
}
class CmdFun {
}
class Handler {
    constructor() {
        this._crc = new Crc();
        this._handles = {};
        this._crc.makeTable();
    }
    crc(name) {
        return this._crc.crc32(name);
    }
    register(cls, name, func, obj) {
        let cf = new CmdFun();
        cf.cls = cls;
        cf.obj = obj;
        cf.func = func;
        let no = this.crc(name);
        this._handles[no] = cf;
    }
    redirect(name, func) {
        let no = this.crc(name);
        let h = this._handles[no];
        h.callback = func;
    }
    onCmd(no, data) {
        let h = this._handles[no];
        if (h == null) {
            console.error("unhandled cmd: ", no);
            return false;
        }
        let v = h.cls.decode(data.bytes);
        console.log("Handler::onCmd: ", v);
        if (h.func != null) {
            h.func.call(h.obj, v);
        }
        if (h.callback != null) {
            h.callback(v);
        }
        return true;
    }
}
class Neter {
    constructor() {
        this._reconnId = 0;
        this._reconnCount = 0;
        this._reconnMaxCount = 6;
        this._disconnectTime = 0;
        this._connected = false;
        this._connecting = false;
        this._buffer = new ByteArray();
        this._closeTime = 0;
        this._closeCount = 0;
        this._buffer.endian = Endian.BIG_ENDIAN;
    }
    create() {
        return null;
    }
    get connected() {
        return this._socket && this._connected;
    }
    connect(gameUrl) {
        let socket = this.create();
        this._socket = socket;
        if (null != gameUrl) {
            this._gameUrl = gameUrl;
        }
        this._connected = false;
        this._connecting = true;
        socket.connect(this._gameUrl);
        console.log(": " + this._gameUrl);
    }
    close() {
        this.clearTimeout(this._reconnId);
        this._socket.close();
    }
    reconnect() {
        this.onReconnect();
        this._socket.close();
        this.connect(this._gameUrl);
    }
    send(data) {
        if (!this._connected) {
            return false;
        }
        data.position = 0;
        this._socket.send(data.buffer);
        return true;
    }
    onClose() {
    }
    onConnect() {
    }
    onReconnect() {
    }
    onMessage(data) {
    }
    setTimeout(fn, delay, ...rest) {
        return null;
    }
    clearTimeout(id) {
    }
    onSockError() {
        this._connected = false;
        this.clearTimeout(this._reconnId);
        if (this._reconnCount++ < this._reconnMaxCount) {
            this._reconnId = this.setTimeout(() => {
                this.reconnect();
            }, 1000);
        }
        else {
            this.onClose();
        }
    }
    timestamp() {
        return new Date().getTime();
    }
    onSockClose() {
        this._connected = false;
        let cur = this.timestamp();
        if (cur - this._closeTime > 6000) {
            this._closeCount = 0;
        }
        this._closeTime = cur;
        this.clearTimeout(this._reconnId);
        if (this._closeCount++ < this._reconnMaxCount) {
            this._reconnId = this.setTimeout(() => {
                this.reconnect();
            }, 1000);
        }
        else {
            this.onClose();
        }
    }
    onSockConnect() {
        this._connected = true;
        this._connecting = false;
        this._reconnCount = 0;
        this.clearTimeout(this._reconnId);
        this.onConnect();
    }
    onSockReceive(data) {
        this._buffer._writeUint8Array(new Uint8Array(data));
        this.onMessage(this._buffer);
        this._buffer.clear();
    }
}
class Networker extends Neter {
    constructor(service, handler) {
        super();
        this._curHeartbeat = 0;
        this._totalHeartbeat = 15000;
        this._buf = new ByteArray();
        this._service = service;
        this._handler = handler;
        this._buf.endian = Endian.BIG_ENDIAN;
    }
    get url() {
        return this._url;
    }
    set url(v) {
        this._url = v;
    }
    crcv(cmd) {
        let name = this._service.find(cmd.constructor);
        //return this._handler.crc(cmd.cmx);
        return this._handler.crc(name);
    }
    create() {
        return new WebSock(this);
    }
    marshal(cmd) {
        var no = this.crcv(cmd);
        //console.log("cmd: " + cmd.cmd + "  no: " + no);
        var buf = this._buf;
        buf.clear();
        var d = this.proto(cmd);
        //var size = 4 + d.byteLength;
        buf.writeUnsignedInt(no);
        buf.writeBytes(new ByteArray(d));
        return buf;
    }
    sendCmd(cmd, func) {
        if (func != null) {
            this._handler.redirect(this._service.find(cmd.constructor), func);
        }
        return this.send(this.marshal(cmd));
    }
    onConnect() {
        console.debug(":");
        this._service.onConnect();
    }
    onClose() {
        //LoadingHelper.ins().hideLoading();
        let ok = () => {
            //x.close();
        };
        this._service.onError("net err");
        //WarnWin.show("connection is broken, please relogin", ok, this, ok, this);
    }
    onReconnect() {
        console.log("Networker::onReconnect ..........");
        this._service.onReconntct();
        //LoadingHelper.ins().showLoading();
    }
    onMessage(b) {
        let len = b.position;
        b.position = 0;
        var no = b.readUnsignedInt();
        var data = new ByteArray();
        b.readBytes(data, 0, len - 4);
        this._handler.onCmd(no, data);
    }
    proto(cmd) {
        return cmd.__proto__.constructor.encode(cmd).finish();
    }
    onLoop(dt) {
        this._curHeartbeat += dt;
        if (this._curHeartbeat >= this._totalHeartbeat) {
            this._curHeartbeat = 0;
            this.sendHeartbeat();
        }
    }
    sendHeartbeat() {
        if (this.connected == false) {
            return;
        }
        let cm = new cmd.KeepaliveCmd();
        this.sendCmd(cm);
        console.debug("send keep alive");
    }
    post(cmd, func) {
        if (func != null) {
            this._handler.redirect(this._service.find(cmd.constructor), func);
        }
        var buf = this.marshal(cmd);
        var self = this;
        Networker.post(this._url, new Uint8Array(buf.buffer), function (data) {
            self.onRecv(data);
        }, function (err) {
            self.onError(err);
        });
    }
    static post(url, data, succ, fail) {
        var req = new XMLHttpRequest();
        req.open("POST", url, true);
        req.responseType = "arraybuffer";
        //req.withCredentials = true;
        req.onload = function (e) {
            if (req.status === 200) {
                var arrayBuffer = req.response; // Note: not oReq.responseText
                succ(arrayBuffer);
            }
            else {
                if (fail) {
                    fail("failed http status: " + req.status);
                }
            }
        };
        req.onerror = function (e) {
            if (fail) {
                fail("http post failed");
            }
        };
        req.send(data);
    }
    onError(err) {
        this._service.onError(err);
    }
    onRecv(data) {
        var b = this._buf;
        b.position = 0;
        b.clear();
        b._writeUint8Array(new Uint8Array(data));
        this.onMessage(b);
    }
}
class WebSock {
    constructor(neter) {
        this.neter = neter;
        if (!window["WebSocket"]) {
            console.error("websocket is not supported");
        }
    }
    /*public connecte(host:string, port:number):void {
        let socketServerUrl = "ws://" + host + ":" + port;
        this.socket = new window["WebSocket"](socketServerUrl);
        this.socket.binaryType = "arraybuffer";
        this.bindEvent();
    }*/
    connect(url) {
        this.socket = new window["WebSocket"](url);
        this.socket.binaryType = "arraybuffer";
        this.bindEvent();
    }
    bindEvent() {
        let self = this;
        let socket = this.socket;
        socket.onopen = function () {
            if (self.neter) {
                self.neter.onSockConnect();
            }
        };
        socket.onclose = function (e) {
            if (self.neter) {
                self.neter.onSockClose();
            }
        };
        socket.onerror = function (e) {
            if (self.neter) {
                self.neter.onSockError();
            }
        };
        socket.onmessage = function (e) {
            if (self.neter) {
                self.neter.onSockReceive(e.data);
            }
        };
    }
    send(message) {
        this.socket.send(message);
    }
    close() {
        this.socket.close();
    }
}
class Sprite {
    constructor(name, img, source) {
        this._img = img;
        this._name = name;
        this._source = source;
    }
    get img() {
        return this._img;
    }
    get name() {
        return this._name;
    }
    get x() {
        return this._source.x;
    }
    get y() {
        return this._source.y;
    }
    get w() {
        return this._source.w;
    }
    get h() {
        return this._source.h;
    }
}
class Asset {
    constructor() {
        this.funcs = [];
    }
    onload(res) {
        this.res = res;
        if (this.funcs) {
            for (var func of this.funcs) {
                func(res);
            }
            this.funcs = null;
        }
    }
}
class Assetser {
    constructor() {
        this._map = {};
        this._sprs = {};
    }
    getRes(src) {
        return this._map[src];
    }
    getSprite(name) {
        return this._sprs[name];
    }
    loadAsset(src, asset) {
        var pos = src.lastIndexOf(".");
        var ext = src.substr(pos);
        if (ext == ".png" || ext == ".jpg") {
            var self = this;
            asset.res = this.createImage(src, function () {
                asset.onload(asset.res);
                self.onLoadImage(src, asset.res);
            });
        }
        else if (ext == ".json") {
            var self = this;
            this.loadJson(src, function (data) {
                asset.onload(data);
            });
        }
    }
    onLoadImage(name, img) {
        var idx = name.indexOf(".");
        name = name.substr(0, idx);
        idx = name.lastIndexOf("/");
        name = name.substr(idx);
        this._sprs[name] = new Sprite(name, img, { x: 0, y: 0, w: img.width, h: img.height });
    }
    loadJson(src, onload) {
        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("application/json");
        rawFile.open("GET", src, true);
        rawFile.onreadystatechange = function () {
            if (rawFile.readyState === 4 && rawFile.status == 200) {
                onload(rawFile.responseText);
            }
        };
        rawFile.send(null);
    }
    createImage(src, onload) {
        var img = document.createElement('img');
        Dom.on(img, 'load', onload, null);
        img.src = src;
        return img;
    }
    loadAssets(srcs, callback) {
        var count = srcs.length;
        var onload = function () {
            if (--count == 0 && callback) {
                callback();
            }
        };
        for (var n = 0; n < srcs.length; n++) {
            var src = srcs[n];
            var asset = this._map[src];
            if (asset) {
                if (asset.funcs == null) {
                    --count;
                }
                else {
                    asset.funcs.push(onload);
                }
            }
            else {
                asset = new Asset();
                asset.funcs.push(function () {
                    if (--count == 0 && callback) {
                        callback();
                    }
                });
                this._map[src] = asset;
                this.loadAsset(src, asset);
            }
        }
        if (count <= 0 && callback) {
            callback();
        }
    }
    loadSheet(name) {
        var str = this.getRes(name + ".json");
        var sprite = this.getRes(name + ".png");
        var v = JSON.parse(str);
        for (var name in v.frames) {
            this._sprs[name] = new Sprite(name, sprite, v.frames[name]);
        }
    }
    loadSheets(names) {
        for (var name of names) {
            this.loadSheet(name);
        }
    }
}
class Conf {
}
// canvas
Conf.width = 1024;
// canvas
Conf.height = 768;
//  px
Conf.TOP_PADDING = 40.5;
//  px
Conf.LEFT_PADDING = 10.5;
//  px
Conf.LINE_SPACE = 10;
//  px
// ROW_SPACE: 80,
Conf.ROW_SPACE = function () {
    return this.LINE_SPACE * 4 * 2;
};
// 
Conf.LINE_COLOR = 'black';
// 
Conf.LINE_WIDTH = 1;
//     
Conf.CLEF_SPACE = 40;
// 
// TSG_SPACE: 56, 
Conf.TSG_SPACE = function () {
    //  +  + *4(44)* +  = canvas
    return (Conf.width - this.LEFT_PADDING * 2 - this.CLEF_SPACE) / 4 / 4;
};
// G 
Conf.CLEF_G = 'G';
// F 
Conf.CLEF_F = 'F';
// C 
Conf.CLEF_C = 'C';
// G  G
Conf.CLEF_G_SPE = 0.64;
// F  F
Conf.CLEF_F_SPE = 0.857;
// C  C
Conf.CLEF_C_SPE = 0.769;
// 
Conf.UNIT_NOTE = 4;
// 
Conf.NOTEBODY_HEIGHT = 30;
// /2 
Conf.NOTE_HEAD_WIDTH = 5;
//  
Conf.NOTETAIL_LINKLINE_WIDTH = 3;
// 
Conf.DOT_LEFT = 10;
// 
Conf.DOT_R = 1.5;
//  
Conf.NOTETAIL_SINGLE_LINE_LENGTH = 12.5;
/* *
 * GC4c[4]
 * G(11+0.51.5)
 * 5 -----------5
 * ......
 * 2 ---------2
 * 1 -------1
 * 0
 * -1
 */
Conf.G_MA2SC = {
    //	  0		 1	    2	  3	    4	 5	  6	   7   8	
    'c': [null, -10.5, -7, -3.5, 0, 3.5, 7, 7, 10.5],
    'd': [null, -10, -6.5, -3, 0.5, 4, 7.5, 7.5],
    'e': [null, -9.5, -6, -2.5, 1, 4.5, 8, 8],
    'f': [null, -9, -5.5, -2, 1.5, 5, 8.5, 8.5],
    'g': [null, -8.5, -5, -1.5, 2, 5.5, 9, 9],
    'a': [-11.5, -8, -4.5, -1, 2.5, 6, 9.5, 9.5],
    'b': [-11, -7.5, -4, -0.5, 3, 6.5, 10, 10]
};
Conf.split = {
    // 
    note: /\//g,
    // 
    note_group: /\s+/g,
};
// 
Conf.sharp = '#';
// 
Conf.flat = 'b';
;
class Dom {
    static get(id) {
        return ((id instanceof HTMLElement) || (id === document)) ? id : document.getElementById(id);
    }
    static set(id, html) {
        Dom.get(id).innerHTML = html;
    }
    static on(ele, type, fn, capture) {
        Dom.get(ele).addEventListener(type, fn, capture);
    }
    static un(ele, type, fn, capture) {
        Dom.get(ele).removeEventListener(type, fn, capture);
    }
    static toggleClassName(ele, name, on) {
        ele = Dom.get(ele);
        var classes = ele.className.split(' ');
        var n = classes.indexOf(name);
        on = (typeof on == 'undefined') ? (n < 0) : on;
        if (on && (n < 0))
            classes.push(name);
        else if (!on && (n >= 0))
            classes.splice(n, 1);
        ele.className = classes.join(' ');
    }
}
Dom.storage = window.localStorage || {};
class Quill {
    constructor(ctx, sheet) {
        this._ctx = ctx;
        this._sheet = sheet;
    }
    /* *
    *  
    * @param 
    * 
    */
    drawLink2point(x, y, x2, y2, width, color) {
        this._ctx.beginPath();
        this._ctx.lineWidth = width;
        this._ctx.strokeStyle = color;
        this._ctx.moveTo(x, y);
        this._ctx.lineTo(x2, y2);
        this._ctx.stroke();
        this._ctx.closePath();
    }
    /* *
    *  
    * @para 
    */
    drawPoint(x, y, r, color) {
        this._ctx.fillStyle = color;
        this._ctx.beginPath();
        this._ctx.arc(x, y, r, 0, Math.PI * 2, true);
        this._ctx.closePath();
        this._ctx.fill();
    }
    /* *
    *   
    * @param 
    */
    drawline(left, top, width, lineConf, lineSpace, lineWidth, lineColor) {
        this._ctx.beginPath();
        this._ctx.lineWidth = lineWidth;
        this._ctx.strokeStyle = lineColor;
        for (var i = 0, t = top; i < lineConf; i++, t += lineSpace) {
            this._ctx.moveTo(left, t);
            this._ctx.lineTo(left + width, t);
        }
        this._ctx.stroke();
        this._ctx.closePath();
    }
    /* *
    *   
    * @param 
    */
    drawFullPageLine(left, top, width, lineConf, lineSpace, lineWidth, lineColor, rowSpace, rowConf) {
        for (var i = 0, t = top; i < rowConf; i++, t += rowSpace)
            this.drawline(left, t, width, lineConf, lineSpace, lineWidth, lineColor);
    }
    /* *
    *  
    * @param 
    */
    drawNoteHead(x, y, fr) {
        this._ctx.beginPath();
        var note = this._sheet.noteHead;
        if (fr <= 2) {
            note = this._sheet.noteHead2;
        }
        /*  */
        var w = note.w / 2.3;
        var h = note.h / 2;
        this._ctx.drawImage(note, x - w / 2, y - h + Conf.LINE_SPACE / 2, w, h);
        this._ctx.closePath();
    }
    /* *
    *  
    * @param 
    * @param 
    * @param  Boolean
    */
    _drawNoteTail(x, y, isUpward) {
        var note = this._sheet.note8Tail;
        var w = note.w / 2.5;
        var h = note.h / 2;
        var oX = x + Conf.NOTE_HEAD_WIDTH;
        var oY = y - h;
        this._ctx.beginPath();
        if (!isUpward) {
            note = this._sheet.note8TailRev;
            oX = x - Conf.NOTE_HEAD_WIDTH;
            oY = y;
        }
        /*  */
        this._ctx.drawImage(note, oX, oY, w, h);
        this._ctx.closePath();
    }
    /* *
    *  fr
    * @param 
    */
    drawNoteTails(x, y, fr, isUpward) {
        var forward = 1;
        var startX = x + Conf.NOTE_HEAD_WIDTH;
        var endY = y - Conf.NOTEBODY_HEIGHT;
        if (!isUpward) {
            startX = x - Conf.NOTE_HEAD_WIDTH;
            endY = y + Conf.NOTEBODY_HEIGHT;
            forward = -1;
        }
        this.drawLink2point(startX, y, startX, endY, 1, Conf.LINE_COLOR);
        for (var k = 0, count = Math.log(fr / 8) / Math.log(2) + 1; k < count; k++)
            this._drawNoteTail(x, y + k * Conf.NOTETAIL_LINKLINE_WIDTH * 3 * forward, isUpward);
    }
    /* *
    *  fr 
    * @param 
    */
    drawNoteTailsAutoForward(x, baseY, y, fr) {
        var midY = baseY - 3 * Conf.LINE_SPACE; // y
        var isUp = true;
        if (y < midY)
            isUp = false;
        this.drawNoteTails(x, y, fr, isUp);
    }
    /* *
    *     
    * @param [ {x, baseY, yMax, yMin, fr}, {x2, baseY, yMax2, yMin2, fr2}, ... ]
    * @param  Boolean
    */
    drawStemTailLine(xyf, isUpward) {
        // isUpward = false;
        //  
        var isUp = isUpward !== undefined ? isUpward : true;
        var forward = isUp ? 1 : -1;
        // 
        var first = xyf[0];
        // 1. 
        var x = isUp ? first.x + Conf.NOTE_HEAD_WIDTH : first.x - Conf.NOTE_HEAD_WIDTH;
        var y = isUp ? first.yMax : first.yMin;
        var yDist = first.yMax - first.yMin;
        var yEnd = y - (Conf.NOTEBODY_HEIGHT + yDist) * forward; // yEndy
        var firstYEnd = yEnd;
        this.drawLink2point(x, y, x, yEnd, 1, Conf.LINE_COLOR);
        if (xyf.length == 1)
            return;
        // 
        var last = xyf[xyf.length - 1];
        // /2 
        var tan = ((first.yMax + first.yMin) / 2 - (last.yMax + last.yMin) / 2) / (last.x - first.x) / 2;
        var lastX, lastY, lastYEnd; // x, y, yEnd
        var lastCount, count, shortLineStartX, shortLineEndX;
        for (var i = 1; i < xyf.length; i++) {
            lastX = x;
            lastY = y;
            lastYEnd = yEnd; // y
            /* 1.  */
            x = isUp ? xyf[i].x + Conf.NOTE_HEAD_WIDTH : xyf[i].x - Conf.NOTE_HEAD_WIDTH;
            y = isUp ? xyf[i].yMax : xyf[i].yMin;
            yDist = xyf[i].yMax - xyf[i].yMin;
            yEnd = firstYEnd - (xyf[i].x - xyf[0].x) * tan;
            this.drawLink2point(x, y, x, yEnd, 1, Conf.LINE_COLOR);
            /* 2.   */
            // lastCount; xyf[i-1].frfr
            lastCount = Math.log(xyf[i - 1].fr / 8) / Math.log(2) + 1; // log2fr/8
            // count; xyf[i].frfr
            count = Math.log(xyf[i].fr / 8) / Math.log(2) + 1;
            // sub: 
            var sub = lastCount - count;
            /*  */
            var acroCount = Math.max(count, lastCount) - Math.abs(sub);
            for (var j = 0; j < acroCount; j++)
                this.drawLink2point(lastX, lastYEnd += Conf.NOTETAIL_LINKLINE_WIDTH * 2 * j * forward, x, lastYEnd - (x - lastX) * tan, Conf.NOTETAIL_LINKLINE_WIDTH, Conf.LINE_COLOR);
            /*  */
            var isSecond = (i == 1) ? 1 : -1; // 
            shortLineStartX = (i == 1) ? lastX : lastX - Conf.NOTETAIL_SINGLE_LINE_LENGTH / 2;
            shortLineEndX = shortLineStartX + Conf.NOTETAIL_SINGLE_LINE_LENGTH / 2;
            for (var k = 0; k < sub; k++)
                this.drawLink2point(shortLineStartX, lastYEnd -= (shortLineStartX - lastX) * tan - Conf.NOTETAIL_LINKLINE_WIDTH * 2 * (k + 1) * forward, shortLineEndX, lastYEnd - Conf.NOTETAIL_SINGLE_LINE_LENGTH / 2 * tan, Conf.NOTETAIL_LINKLINE_WIDTH, Conf.LINE_COLOR);
        }
        /*  */
        var endSub = count - lastCount;
        shortLineStartX = x - Conf.NOTETAIL_SINGLE_LINE_LENGTH / 2;
        for (var m = 0; m < endSub; m++)
            this.drawLink2point(shortLineStartX, lastYEnd -= (shortLineStartX - lastX) * tan - Conf.NOTETAIL_LINKLINE_WIDTH * 2 * (m + 1) * forward, x, lastYEnd - Conf.NOTETAIL_SINGLE_LINE_LENGTH / 2 * tan, Conf.NOTETAIL_LINKLINE_WIDTH, Conf.LINE_COLOR);
    }
    /* *
    *      
    * @param [ {x, baseY, yMax, yMin, fr}, {x2, baseY, yMax2, yMin2, fr2}, ... ]
    * @param  Boolean
    */
    drawStemTailLineAutoForward(XYFrs) {
        if (XYFrs.length == 0)
            return;
        var isUp = true;
        var sum = 0;
        var midY = XYFrs[0].baseY - 3 * Conf.LINE_SPACE; // y
        for (var i = 0; i < XYFrs.length; i++)
            sum += XYFrs[i].yMax + XYFrs[i].yMin;
        var avg = sum / (XYFrs.length * 2);
        if (avg < midY)
            isUp = false;
        this.drawStemTailLine(XYFrs, isUp);
    }
    /* *
    *  
    * @param 
    */
    drawClef(x, y, type, color) {
        this._ctx.beginPath();
        var _y, w, h; // 
        // G
        if (type == Conf.CLEF_G) {
            _y = y - Conf.LINE_SPACE * 2;
            /*  */
            w = this._sheet.clefG.w;
            h = this._sheet.clefG.h;
            this._ctx.drawImage(this._sheet.clefG, x - w / 2, _y - h * Conf.CLEF_G_SPE, w, h);
        }
        // C
        if (type == Conf.CLEF_C) {
            _y = y - Conf.LINE_SPACE * 2;
            /*  */
            w = this._sheet.clefC.w;
            h = this._sheet.clefC.h;
            this._ctx.drawImage(this._sheet.clefC, x - w / 2, _y - h * Conf.CLEF_C_SPE, w, h);
        }
        // F
        if (type == Conf.CLEF_F) {
            _y = y - Conf.LINE_SPACE * 2;
            /*  */
            w = this._sheet.clefF.w;
            h = this._sheet.clefF.h;
            this._ctx.drawImage(this._sheet.clefF, x - w / 2, _y - h * Conf.CLEF_F_SPE, w, h);
        }
        this._ctx.closePath();
    }
    /* *
    *  
    * @param 
    */
    drawBarLine(x, y, width, color) {
        this.drawLink2point(x, y, x, y + Conf.LINE_SPACE * 4, width, color);
    }
    /* *
    *  
    * @param (string)
    */
    drawTransp(x, y, type) {
        if (type == Conf.sharp) { // 
            /*  */
            var w = this._sheet.sharp.w / 4;
            var h = this._sheet.sharp.h / 4;
            this._ctx.drawImage(this._sheet.sharp, x - w, y - h / 2, w, h);
        }
        else if (type == Conf.flat) { // 
            /*  */
            var w = this._sheet.flats.w / 4;
            var h = this._sheet.flats.h / 4;
            this._ctx.drawImage(this._sheet.flats, x - w, y - h / 2, w, h);
        }
    }
}
class Render {
    static reset() {
        Render.textCount = 0;
        Render.rectCount = 0;
        Render.circleCount = 0;
        Render.drawCount = 0;
        Render.polygonCount = 0;
        Render.spriteCount = 0;
    }
    static polygon(ctx, x1, y1, x2, y2, x3, y3, x4, y4, color) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.lineTo(x3, y3);
        ctx.lineTo(x4, y4);
        ctx.closePath();
        ctx.fill();
        Render.polygonCount++;
    }
    static circle(ctx, x, y, r, fillStyle) {
        //ctx.fillStyle="#FF0000";                                    
        ctx.fillStyle = fillStyle;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2, true); //Math.PI*2JS
        ctx.closePath();
        ctx.fill();
        Render.circleCount++;
    }
    static fillRect(ctx, x, y, w, h, fillStyle) {
        ctx.fillStyle = fillStyle;
        ctx.fillRect(x, y, w, h);
        Render.rectCount++;
    }
    static drawImage(ctx, sprite, sx, sy, sw, sh, dx, dy, dw, dh) {
        ctx.drawImage(sprite, sx, sy, sw, sh, dx, dy, dw, dh);
        Render.drawCount++;
    }
    static fillText(ctx, text, x, y, font, fillStyle, textAlign, textBaseline) {
        ctx.textAlign = textAlign || 'left';
        ctx.textBaseline = textBaseline || "middle";
        ctx.fillStyle = fillStyle || fillStyle;
        ctx.font = font;
        ctx.fillText(text, x, y);
        Render.textCount++;
    }
    static drawLine(ctx, sx, sy, dx, dy, lineWidth, fillStyle) {
        ctx.beginPath();
        ctx.strokeStyle = fillStyle;
        ctx.moveTo(sx, sy);
        ctx.lineTo(dx, dy);
        ctx.lineWidth = lineWidth;
        ctx.stroke();
        ctx.closePath();
    }
    static drawCross(ctx, x, y, w, h, lineWidth, fillStyle) {
        Render.drawLine(ctx, x, y, x + w, y + h, lineWidth, fillStyle);
        Render.drawLine(ctx, x, y + h, x + w, y, lineWidth, fillStyle);
        Render.drawLine(ctx, x - 1, y + h / 2, x + w + 1, y + h / 2, lineWidth, fillStyle);
    }
}
Render.textCount = 0;
Render.rectCount = 0;
Render.circleCount = 0;
Render.drawCount = 0;
Render.polygonCount = 0;
Render.spriteCount = 0;
class Staff {
    constructor(canvas) {
        this._lineX = 0;
        this._lineY = 30;
        this._ballY = 6;
        this._minBallY = 6;
        this._maxBallY = 24;
        this._ballSpeed = 1;
        this.x_cur = 0;
        this.y_def = 0;
        this._canvas = canvas;
        this._ctx = canvas.getContext('2d');
        //canvas.style.width = Staff.width + "px";
        //canvas.style.height = Staff.height + "px";
        canvas.width = Conf.width;
        canvas.height = Conf.height;
    }
    launch(asseter) {
        var sheet = {
            note1: asseter.getSprite('note1'),
            clefG: asseter.getSprite('clefG'),
            clefC: asseter.getSprite('clefC'),
            clefF: asseter.getSprite('clefF'),
            noteHead: asseter.getSprite('noteHead'),
            noteHead2: asseter.getSprite('noteHead2'),
            note8Tail: asseter.getSprite('note8Tail'),
            note8TailRev: asseter.getSprite('note8TailRev'),
            sharp: asseter.getSprite('sharp'),
            flats: asseter.getSprite('flats')
        };
        this._quill = new Quill(this._ctx, sheet);
        var self = this;
        var win = window;
        function frame() {
            self.onFrame();
            win.requestAnimationFrame(frame, self._canvas);
        }
        frame();
    }
    onFrame() {
        this._ctx.clearRect(0, 0, this._width, this._height);
        this._ctx.fillStyle = '#72D7EE';
        this._ctx.fillRect(0, 0, this._width, this._height);
        this.reset();
        this._ctx.clearRect(0, 0, Conf.width, Conf.height);
        this.drawBackground();
        //this.drawLines();
        this.rowEnter(null);
        this.moveLine();
        this.moveBall();
    }
    drawBackground() {
    }
    moveLine() {
        //this._quill.drawLink2point(this._lineX, this._lineY, this._lineX, this._lineY + Conf.LINE_SPACE*5, Conf.LINE_WIDTH, 'red');
        this._quill.drawBarLine(this._lineX, this._lineY, Conf.LINE_WIDTH, 'red');
        this._lineX += 1;
    }
    moveBall() {
        this._ballY += this._ballSpeed;
        if (this._ballY >= this._maxBallY) {
            this._ballY = this._maxBallY;
            this._ballSpeed = -1;
        }
        else if (this._ballY <= this._minBallY) {
            this._ballY = this._minBallY;
            this._ballSpeed = 1;
        }
        this._quill.drawPoint(this._lineX - 1, this._ballY, 6, 'red');
    }
    // 
    correct() {
    }
    static font(size) {
        return size + "px " + Staff.fontType;
    }
    drawLines() {
        var y = Staff.group1Y;
        for (var i = 0; i < Staff.lineCount; i++) {
            Render.drawLine(this._ctx, 0, y, this._width, y, Staff.lineWidth, Staff.lineColor);
            y += Staff.lineGap;
        }
        y = Staff.group2Y;
        for (var i = 0; i < Staff.lineCount; i++) {
            Render.drawLine(this._ctx, 0, y, this._width, y, Staff.lineWidth, Staff.lineColor);
            y += Staff.lineGap;
        }
        var x = Staff.verticalLineX;
        for (var i = 0; i < 2; i++) {
            Render.drawLine(this._ctx, x, Staff.group1Y + Staff.lineGap, x, Staff.group1Y + Staff.lineGap * 3, Staff.verticalLineWidth, Staff.lineColor);
            x += Staff.verticalLineGap;
        }
        x = 80;
        y = Staff.group1Y + Staff.lineGap * 2;
        Render.drawLine(this._ctx, x, y, x + 40, y, 3, Staff.lineColor);
        x = x + 7;
        Render.fillText(this._ctx, "4", x, Staff.group1Y + Staff.lineGap, Staff.font(40), Staff.lineColor);
        Render.fillText(this._ctx, "4", x, Staff.group1Y + Staff.lineGap * 3 + 6, Staff.font(40), Staff.lineColor);
        Render.drawCross(this._ctx, 170, Staff.group1Y - 20, 10, 10, Staff.lineWidth, Staff.lineColor);
    }
    reset() {
        this.x_cur = 0;
        this.y_def = 0;
    }
    rowEnter(clefs) {
        // n
        var n = 2; //clefs.length;
        // y_def 
        this.y_def += Conf.ROW_SPACE() * (n - 1);
        for (var i = 0; i < n; i++) {
            this.y_def += Conf.ROW_SPACE();
            this.x_cur = Conf.LEFT_PADDING;
            this._quill.drawline(this.x_cur, this.y_def - Conf.LINE_SPACE * 5, Conf.width - Conf.LEFT_PADDING * 2, 5, Conf.LINE_SPACE, Conf.LINE_WIDTH, Conf.LINE_COLOR);
            //  
            this._quill.drawBarLine(this.x_cur, this.y_def - Conf.LINE_SPACE * 5, Conf.LINE_WIDTH, Conf.LINE_COLOR);
            //     
            this.x_cur += Conf.TSG_SPACE() / 2;
            //  
            //this._quill.drawClef(x_cur, y_def, clefs[i], Conf.LINE_COLOR);
            //     
            this.x_cur += Conf.CLEF_SPACE;
        }
        // y_def 
        this.y_def -= Conf.ROW_SPACE() * (n - 1);
    }
}
Staff.lineGap = 20;
Staff.lineWidth = 1;
Staff.lineCount = 5;
Staff.group1Y = 100;
Staff.group2Y = 260;
Staff.lineColor = "#ffffff";
Staff.fontType = "Verdana";
Staff.verticalLineX = 30;
Staff.verticalLineGap = 20;
Staff.verticalLineWidth = 10;
//# sourceMappingURL=service.js.map

var cmd = $root.cmd;

export {
    midi,
    Adapter,
    StudentAdapter,
    TeacherAdapter,
    startService,
    startStudent,
    startTeacher,
    student,
    teacher,
    adminer,
    cmd    
}